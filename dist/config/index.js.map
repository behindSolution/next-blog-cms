{"version":3,"sources":["../../src/config/index.ts"],"names":["require"],"mappings":"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","file":"index.js","sourcesContent":["import fs from 'node:fs';\nimport path from 'node:path';\nimport { createRequire } from 'node:module';\n\nexport interface BlogDatabaseConfig {\n  path?: string;\n}\n\nexport interface BlogLanguagesConfig {\n  default: string;\n  available: string[];\n}\n\nexport interface BlogAuthConfig {\n  jwtSecret: string;\n  sessionDuration?: number;\n}\n\nexport interface BlogThemeConfig {\n  primaryColor?: string;\n}\n\nexport interface BlogAiTranslatorOpenAIConfig {\n  provider: 'openai';\n  apiKey?: string;\n  model?: string;\n  baseUrl?: string;\n}\n\nexport interface BlogAiConfig {\n  translator?: BlogAiTranslatorOpenAIConfig;\n}\n\nexport interface BlogConfig {\n  database?: BlogDatabaseConfig;\n  languages?: BlogLanguagesConfig;\n  auth?: BlogAuthConfig;\n  theme?: BlogThemeConfig;\n  ai?: BlogAiConfig;\n}\n\nexport const defaultBlogConfig: Required<BlogConfig> = {\n  database: { path: './blog.db' },\n  languages: { default: 'en', available: ['en', 'pt'] },\n  auth: { jwtSecret: process.env.BLOG_JWT_SECRET ?? 'change-me', sessionDuration: 7 },\n  theme: { primaryColor: '#3b82f6' },\n  ai: {}\n};\n\nlet cachedConfig: Required<BlogConfig> | null = null;\nlet configFilePath: string | null = null;\nlet configFileTimestamp: number | null = null;\n\nconst requireFromPath = (filePath: string) => {\n  try {\n    const require = createRequire(import.meta.url);\n    return require(filePath);\n  } catch (error) {\n    if (filePath.endsWith('.cjs')) {\n      const code = fs.readFileSync(filePath, 'utf8');\n      const module = { exports: {} };\n      const func = new Function('module', 'exports', 'require', code);\n      func(module, module.exports, createRequire(filePath));\n      return module.exports;\n    }\n    throw error;\n  }\n};\n\nexport function getBlogConfig(): Required<BlogConfig> {\n  if (cachedConfig && configFilePath && configFileTimestamp) {\n    try {\n      const currentTimestamp = fs.statSync(configFilePath).mtimeMs;\n      if (currentTimestamp === configFileTimestamp) {\n        return cachedConfig;\n      }\n      console.log('[next-blog-cms] Config file changed, reloading...');\n      cachedConfig = null;\n    } catch {\n      cachedConfig = null;\n    }\n  }\n\n  const userConfig = loadUserConfig();\n  cachedConfig = mergeConfig(defaultBlogConfig, userConfig);\n  \n  return cachedConfig;\n}\n\nfunction loadUserConfig(): BlogConfig | undefined {\n  const cwd = process.cwd();\n  const candidates = ['blog.config.js', 'blog.config.cjs', 'blog.config.json'];\n\n  for (const candidate of candidates) {\n    const filePath = path.resolve(cwd, candidate);\n    \n    if (!fs.existsSync(filePath)) {\n      continue;\n    }\n\n    try {\n      if (filePath.endsWith('.json')) {\n        const raw = fs.readFileSync(filePath, 'utf8');\n        configFilePath = filePath;\n        configFileTimestamp = fs.statSync(filePath).mtimeMs;\n        return JSON.parse(raw) as BlogConfig;\n      }\n\n      if (filePath.endsWith('.cjs') || filePath.endsWith('.js')) {\n        const loaded = requireFromPath(filePath);\n        configFilePath = filePath;\n        configFileTimestamp = fs.statSync(filePath).mtimeMs;\n        \n        if (loaded && typeof loaded === 'object') {\n          console.log('[next-blog-cms] Successfully loaded config from', candidate);\n          return (loaded.default ?? loaded) as BlogConfig;\n        }\n      }\n    } catch (error) {\n      console.warn(`[next-blog-cms] Unable to load ${candidate}:`, error);\n    }\n  }\n\n  console.warn('[next-blog-cms] No config file found, using defaults');\n  return undefined;\n}\n\nfunction mergeConfig(\n  defaults: Required<BlogConfig>,\n  overrides?: BlogConfig\n): Required<BlogConfig> {\n  const merged: Required<BlogConfig> = {\n    database: {\n      ...defaults.database,\n      ...(overrides?.database ?? {})\n    },\n    languages: {\n      default: overrides?.languages?.default ?? defaults.languages.default,\n      available: overrides?.languages?.available ?? defaults.languages.available\n    },\n    auth: {\n      jwtSecret: overrides?.auth?.jwtSecret ?? defaults.auth.jwtSecret,\n      sessionDuration: overrides?.auth?.sessionDuration ?? defaults.auth.sessionDuration\n    },\n    theme: {\n      ...defaults.theme,\n      ...(overrides?.theme ?? {})\n    },\n    ai: {\n      translator: overrides?.ai?.translator ?? defaults.ai.translator\n    }\n  };\n\n  if (!merged.languages.available.includes(merged.languages.default)) {\n    merged.languages.available = [\n      merged.languages.default,\n      ...merged.languages.available\n    ];\n  }\n\n  merged.languages.available = Array.from(\n    new Set(merged.languages.available.map((code) => code.trim()).filter(Boolean))\n  );\n\n  return merged;\n}"]}