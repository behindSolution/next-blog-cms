{"version":3,"sources":["../../src/lib/http.ts","../../src/db/queries/users.ts","../../src/config/index.ts","../../src/db/schema.ts","../../src/db/migrations.ts","../../src/db/index.ts","../../src/db/queries/categories.ts","../../src/db/queries/posts.ts","../../src/db/queries/languages.ts","../../src/lib/cookies.ts","../../src/lib/auth.ts","../../src/lib/validation.ts","../../src/lib/utils.ts","../../src/api/routes/auth.ts","../../src/api/utils/query.ts","../../src/api/routes/posts.ts","../../src/api/routes/categories.ts","../../src/api/routes/users.ts","../../src/api/routes/languages.ts","../../src/lib/ai/translator.ts","../../src/api/routes/ai.ts","../../src/api/router.ts","../../src/api/utils.ts","../../src/api/index.ts"],"names":["HttpStatus","require","path","db","fs","data","post","category","ensureAdmin","serializeUser","language"],"mappings":"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","file":"index.js","sourcesContent":["export enum HttpStatus {\n  OK = 200,\n  CREATED = 201,\n  NO_CONTENT = 204,\n  BAD_REQUEST = 400,\n  UNAUTHORIZED = 401,\n  FORBIDDEN = 403,\n  NOT_FOUND = 404,\n  METHOD_NOT_ALLOWED = 405,\n  CONFLICT = 409,\n  TOO_MANY_REQUESTS = 429,\n  INTERNAL_SERVER_ERROR = 500\n}\n\nexport interface HttpErrorOptions {\n  status?: HttpStatus;\n  code?: string;\n  details?: unknown;\n}\n\nexport class HttpError extends Error {\n  status: HttpStatus;\n  code?: string;\n  details?: unknown;\n\n  constructor(message: string, options: HttpErrorOptions = {}) {\n    super(message);\n    this.name = 'HttpError';\n    this.status = options.status ?? HttpStatus.INTERNAL_SERVER_ERROR;\n    this.code = options.code;\n    this.details = options.details;\n  }\n}\n\nexport function createResponse<T>(data: T | undefined, init?: ResponseInit): Response {\n  const status = init?.status ?? HttpStatus.OK;\n  const headers = new Headers(init?.headers ?? {});\n\n  if (status === HttpStatus.NO_CONTENT) {\n    headers.delete('Content-Type');\n    return new Response(null, {\n      ...init,\n      status,\n      headers\n    });\n  }\n\n  if (!headers.has('Content-Type')) {\n    headers.set('Content-Type', 'application/json');\n  }\n\n  return new Response(JSON.stringify(data), {\n    ...init,\n    status,\n    headers\n  });\n}\n\nexport function createErrorResponse(error: unknown): Response {\n  if (error instanceof HttpError) {\n    return createResponse(\n      {\n        error: {\n          message: error.message,\n          code: error.code,\n          details: error.details\n        }\n      },\n      {\n        status: error.status\n      }\n    );\n  }\n\n  console.error('[next-blog-cms] Erro interno na API:', error);\n\n  return createResponse(\n    {\n      error: {\n        message: 'Erro interno do servidor'\n      }\n    },\n    {\n      status: HttpStatus.INTERNAL_SERVER_ERROR\n    }\n  );\n}\n\nexport function requireMethod(request: Request, methods: string[]) {\n  if (!methods.includes(request.method.toUpperCase())) {\n    throw new HttpError('Method not allowed', {\n      status: HttpStatus.METHOD_NOT_ALLOWED\n    });\n  }\n}\n\n","import type { SqliteDatabase } from '../index';\nimport { getDatabase } from '../index';\n\nexport type UserRole = 'admin' | 'author';\n\nexport interface BlogUserRecord {\n  id: number;\n  email: string;\n  name: string;\n  password_hash: string;\n  role: UserRole;\n  created_at: string;\n}\n\nexport interface CreateUserInput {\n  email: string;\n  name: string;\n  passwordHash: string;\n  role?: UserRole;\n}\n\nexport interface UpdateUserInput {\n  email?: string;\n  name?: string;\n  passwordHash?: string;\n  role?: UserRole;\n}\n\nfunction mapUserRow(row: BlogUserRecord | undefined): BlogUserRecord | null {\n  return row ?? null;\n}\n\nfunction db(): SqliteDatabase {\n  return getDatabase();\n}\n\nexport function createUser(input: CreateUserInput): BlogUserRecord {\n  const result = db()\n    .prepare(\n      `INSERT INTO blog_users (email, name, password_hash, role)\n       VALUES (@email, @name, @password_hash, @role)`\n    )\n    .run({\n      email: input.email,\n      name: input.name,\n      password_hash: input.passwordHash,\n      role: input.role ?? 'author'\n    });\n\n  const created = getUserById(Number(result.lastInsertRowid));\n  if (!created) {\n    throw new Error('Failed to create blog user');\n  }\n\n  return created;\n}\n\nexport function getUserById(id: number): BlogUserRecord | null {\n  const row = db()\n    .prepare('SELECT id, email, name, password_hash, role, created_at FROM blog_users WHERE id = ?')\n    .get(id) as BlogUserRecord | undefined;\n\n  return mapUserRow(row);\n}\n\nexport function getUserByEmail(email: string): BlogUserRecord | null {\n  const row = db()\n    .prepare(\n      'SELECT id, email, name, password_hash, role, created_at FROM blog_users WHERE email = ?'\n    )\n    .get(email) as BlogUserRecord | undefined;\n\n  return mapUserRow(row);\n}\n\nexport function listUsers(): BlogUserRecord[] {\n  return db()\n    .prepare(\n      'SELECT id, email, name, password_hash, role, created_at FROM blog_users ORDER BY created_at DESC'\n    )\n    .all() as BlogUserRecord[];\n}\n\nexport function updateUser(id: number, input: UpdateUserInput): BlogUserRecord | null {\n  const fields: string[] = [];\n  const params: Record<string, unknown> = { id };\n\n  if (typeof input.email !== 'undefined') {\n    fields.push('email = @email');\n    params.email = input.email;\n  }\n\n  if (typeof input.name !== 'undefined') {\n    fields.push('name = @name');\n    params.name = input.name;\n  }\n\n  if (typeof input.passwordHash !== 'undefined') {\n    fields.push('password_hash = @password_hash');\n    params.password_hash = input.passwordHash;\n  }\n\n  if (typeof input.role !== 'undefined') {\n    fields.push('role = @role');\n    params.role = input.role;\n  }\n\n  if (fields.length === 0) {\n    return getUserById(id);\n  }\n\n  db()\n    .prepare(`UPDATE blog_users SET ${fields.join(', ')} WHERE id = @id`)\n    .run(params);\n\n  return getUserById(id);\n}\n\nexport function deleteUser(id: number): void {\n  db().prepare('DELETE FROM blog_users WHERE id = ?').run(id);\n}\n\nexport function countAdmins(): number {\n  const row = db()\n    .prepare(\"SELECT COUNT(*) as count FROM blog_users WHERE role = 'admin'\")\n    .get() as { count: number } | undefined;\n\n  return row?.count ?? 0;\n}\n\n","import fs from 'node:fs';\nimport path from 'node:path';\nimport { createRequire } from 'node:module';\n\nexport interface BlogDatabaseConfig {\n  path?: string;\n}\n\nexport interface BlogLanguagesConfig {\n  default: string;\n  available: string[];\n}\n\nexport interface BlogAuthConfig {\n  jwtSecret: string;\n  sessionDuration?: number;\n}\n\nexport interface BlogThemeConfig {\n  primaryColor?: string;\n}\n\nexport interface BlogAiTranslatorOpenAIConfig {\n  provider: 'openai';\n  apiKey?: string;\n  model?: string;\n  baseUrl?: string;\n}\n\nexport interface BlogAiConfig {\n  translator?: BlogAiTranslatorOpenAIConfig;\n}\n\nexport interface BlogConfig {\n  database?: BlogDatabaseConfig;\n  languages?: BlogLanguagesConfig;\n  auth?: BlogAuthConfig;\n  theme?: BlogThemeConfig;\n  ai?: BlogAiConfig;\n}\n\nexport const defaultBlogConfig: Required<BlogConfig> = {\n  database: { path: './blog.db' },\n  languages: { default: 'en', available: ['en', 'pt'] },\n  auth: { jwtSecret: process.env.BLOG_JWT_SECRET ?? 'change-me', sessionDuration: 7 },\n  theme: { primaryColor: '#3b82f6' },\n  ai: {}\n};\n\nlet cachedConfig: Required<BlogConfig> | null = null;\nlet configFilePath: string | null = null;\nlet configFileTimestamp: number | null = null;\n\nconst requireFromPath = (filePath: string) => {\n  try {\n    const require = createRequire(import.meta.url);\n    return require(filePath);\n  } catch (error) {\n    if (filePath.endsWith('.cjs')) {\n      const code = fs.readFileSync(filePath, 'utf8');\n      const module = { exports: {} };\n      const func = new Function('module', 'exports', 'require', code);\n      func(module, module.exports, createRequire(filePath));\n      return module.exports;\n    }\n    throw error;\n  }\n};\n\nexport function getBlogConfig(): Required<BlogConfig> {\n  if (cachedConfig && configFilePath && configFileTimestamp) {\n    try {\n      const currentTimestamp = fs.statSync(configFilePath).mtimeMs;\n      if (currentTimestamp === configFileTimestamp) {\n        return cachedConfig;\n      }\n      console.log('[next-blog-cms] Config file changed, reloading...');\n      cachedConfig = null;\n    } catch {\n      cachedConfig = null;\n    }\n  }\n\n  const userConfig = loadUserConfig();\n  cachedConfig = mergeConfig(defaultBlogConfig, userConfig);\n  \n  return cachedConfig;\n}\n\nfunction loadUserConfig(): BlogConfig | undefined {\n  const cwd = process.cwd();\n  const candidates = ['blog.config.js', 'blog.config.cjs', 'blog.config.json'];\n\n  for (const candidate of candidates) {\n    const filePath = path.resolve(cwd, candidate);\n    \n    if (!fs.existsSync(filePath)) {\n      continue;\n    }\n\n    try {\n      if (filePath.endsWith('.json')) {\n        const raw = fs.readFileSync(filePath, 'utf8');\n        configFilePath = filePath;\n        configFileTimestamp = fs.statSync(filePath).mtimeMs;\n        return JSON.parse(raw) as BlogConfig;\n      }\n\n      if (filePath.endsWith('.cjs') || filePath.endsWith('.js')) {\n        const loaded = requireFromPath(filePath);\n        configFilePath = filePath;\n        configFileTimestamp = fs.statSync(filePath).mtimeMs;\n        \n        if (loaded && typeof loaded === 'object') {\n          console.log('[next-blog-cms] Successfully loaded config from', candidate);\n          return (loaded.default ?? loaded) as BlogConfig;\n        }\n      }\n    } catch (error) {\n      console.warn(`[next-blog-cms] Unable to load ${candidate}:`, error);\n    }\n  }\n\n  console.warn('[next-blog-cms] No config file found, using defaults');\n  return undefined;\n}\n\nfunction mergeConfig(\n  defaults: Required<BlogConfig>,\n  overrides?: BlogConfig\n): Required<BlogConfig> {\n  const merged: Required<BlogConfig> = {\n    database: {\n      ...defaults.database,\n      ...(overrides?.database ?? {})\n    },\n    languages: {\n      default: overrides?.languages?.default ?? defaults.languages.default,\n      available: overrides?.languages?.available ?? defaults.languages.available\n    },\n    auth: {\n      jwtSecret: overrides?.auth?.jwtSecret ?? defaults.auth.jwtSecret,\n      sessionDuration: overrides?.auth?.sessionDuration ?? defaults.auth.sessionDuration\n    },\n    theme: {\n      ...defaults.theme,\n      ...(overrides?.theme ?? {})\n    },\n    ai: {\n      translator: overrides?.ai?.translator ?? defaults.ai.translator\n    }\n  };\n\n  if (!merged.languages.available.includes(merged.languages.default)) {\n    merged.languages.available = [\n      merged.languages.default,\n      ...merged.languages.available\n    ];\n  }\n\n  merged.languages.available = Array.from(\n    new Set(merged.languages.available.map((code) => code.trim()).filter(Boolean))\n  );\n\n  return merged;\n}","export const CREATE_BLOG_USERS_TABLE = `\nCREATE TABLE IF NOT EXISTS blog_users (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  email TEXT UNIQUE NOT NULL,\n  name TEXT NOT NULL,\n  password_hash TEXT NOT NULL,\n  role TEXT DEFAULT 'author',\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n`;\n\nexport const CREATE_CATEGORIES_TABLE = `\nCREATE TABLE IF NOT EXISTS categories (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  slug TEXT UNIQUE NOT NULL,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n`;\n\nexport const CREATE_CATEGORY_TRANSLATIONS_TABLE = `\nCREATE TABLE IF NOT EXISTS category_translations (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  category_id INTEGER NOT NULL,\n  language TEXT NOT NULL,\n  name TEXT NOT NULL,\n  description TEXT,\n  FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE,\n  UNIQUE(category_id, language)\n);\n`;\n\nexport const CREATE_POSTS_TABLE = `\nCREATE TABLE IF NOT EXISTS posts (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  slug TEXT UNIQUE NOT NULL,\n  author_id INTEGER NOT NULL,\n  category_id INTEGER,\n  featured_image TEXT,\n  status TEXT DEFAULT 'draft',\n  published_at DATETIME,\n  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (author_id) REFERENCES blog_users(id),\n  FOREIGN KEY (category_id) REFERENCES categories(id)\n);\n`;\n\nexport const CREATE_POST_TRANSLATIONS_TABLE = `\nCREATE TABLE IF NOT EXISTS post_translations (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  post_id INTEGER NOT NULL,\n  language TEXT NOT NULL,\n  title TEXT NOT NULL,\n  content TEXT NOT NULL,\n  excerpt TEXT,\n  meta_title TEXT,\n  meta_description TEXT,\n  FOREIGN KEY (post_id) REFERENCES posts(id) ON DELETE CASCADE,\n  UNIQUE(post_id, language)\n);\n`;\n\nexport const CREATE_LANGUAGES_TABLE = `\nCREATE TABLE IF NOT EXISTS languages (\n  code TEXT PRIMARY KEY,\n  name TEXT NOT NULL,\n  is_default INTEGER DEFAULT 0,\n  enabled INTEGER DEFAULT 1\n);\n`;\n\nexport const CREATE_BLOG_MIGRATIONS_TABLE = `\nCREATE TABLE IF NOT EXISTS blog_migrations (\n  id TEXT PRIMARY KEY,\n  applied_at DATETIME DEFAULT CURRENT_TIMESTAMP\n);\n`;\n\nexport const CREATE_POSTS_UPDATED_TRIGGER = `\nCREATE TRIGGER IF NOT EXISTS posts_updated_at_trigger\nAFTER UPDATE ON posts\nFOR EACH ROW\nBEGIN\n  UPDATE posts SET updated_at = CURRENT_TIMESTAMP WHERE id = NEW.id;\nEND;\n`;\n\nexport const CREATE_INDEXES = `\nCREATE INDEX IF NOT EXISTS idx_posts_status ON posts(status);\nCREATE INDEX IF NOT EXISTS idx_posts_published_at ON posts(published_at);\nCREATE INDEX IF NOT EXISTS idx_post_translations_language ON post_translations(language);\nCREATE INDEX IF NOT EXISTS idx_category_translations_language ON category_translations(language);\nCREATE INDEX IF NOT EXISTS idx_posts_author_id ON posts(author_id);\nCREATE INDEX IF NOT EXISTS idx_posts_category_id ON posts(category_id);\n`;\n\nexport const INSERT_DEFAULT_LANGUAGES = `\nINSERT INTO languages (code, name, is_default, enabled)\nVALUES ('en', 'English', 1, 1)\nON CONFLICT(code) DO NOTHING;\n\nINSERT INTO languages (code, name, is_default, enabled)\nVALUES ('pt', 'Portuguese', 0, 1)\nON CONFLICT(code) DO NOTHING;\n`;\n\n","import type { Database } from 'better-sqlite3';\nimport { getBlogConfig } from '../config';\n\nimport {\n  CREATE_BLOG_MIGRATIONS_TABLE,\n  CREATE_BLOG_USERS_TABLE,\n  CREATE_CATEGORIES_TABLE,\n  CREATE_CATEGORY_TRANSLATIONS_TABLE,\n  CREATE_INDEXES,\n  CREATE_LANGUAGES_TABLE,\n  CREATE_POSTS_TABLE,\n  CREATE_POSTS_UPDATED_TRIGGER,\n  CREATE_POST_TRANSLATIONS_TABLE,\n  INSERT_DEFAULT_LANGUAGES\n} from './schema';\n\nexport interface Migration {\n  id: string;\n  up: (db: Database) => void;\n}\n\nconst BASE_MIGRATION_ID = '0001_initial_schema';\n\nconst migrations: Migration[] = [\n  {\n    id: BASE_MIGRATION_ID,\n    up: (db) => {\n      db.exec([\n        CREATE_BLOG_USERS_TABLE,\n        CREATE_CATEGORIES_TABLE,\n        CREATE_CATEGORY_TRANSLATIONS_TABLE,\n        CREATE_POSTS_TABLE,\n        CREATE_POST_TRANSLATIONS_TABLE,\n        CREATE_LANGUAGES_TABLE,\n        CREATE_POSTS_UPDATED_TRIGGER,\n        CREATE_INDEXES,\n        INSERT_DEFAULT_LANGUAGES\n      ].join('\\n'));\n    }\n  }\n];\n\nfunction ensureMigrationsTable(db: Database) {\n  db.exec(CREATE_BLOG_MIGRATIONS_TABLE);\n}\n\nfunction hasMigration(db: Database, id: string): boolean {\n  const row = db.prepare('SELECT id FROM blog_migrations WHERE id = ?').get(id) as\n    | { id: string }\n    | undefined;\n  return Boolean(row);\n}\n\nfunction markMigration(db: Database, id: string) {\n  db.prepare('INSERT INTO blog_migrations (id) VALUES (?)').run(id);\n}\n\nexport function runMigrations(db: Database) {\n  ensureMigrationsTable(db);\n\n  const apply = db.transaction((migration: Migration) => {\n    migration.up(db);\n    markMigration(db, migration.id);\n  });\n\n  for (const migration of migrations) {\n    if (!hasMigration(db, migration.id)) {\n      apply(migration);\n    }\n  }\n\n  applyConfigurationOverrides(db);\n}\n\nfunction applyConfigurationOverrides(db: Database) {\n  synchronizeLanguages(db);\n}\n\nfunction synchronizeLanguages(db: Database) {\n  const config = getBlogConfig();\n  const configuredLanguages = Array.from(\n    new Set([\n      config.languages.default,\n      ...config.languages.available\n    ])\n  );\n\n  if (configuredLanguages.length === 0) {\n    return;\n  }\n\n  // Get existing languages from database\n  const existingLanguages = db\n    .prepare('SELECT code, enabled, is_default FROM languages')\n    .all() as Array<{ code: string; enabled: number; is_default: number }>;\n\n  // Only reset is_default flag to apply the new default from config\n  db.prepare('UPDATE languages SET is_default = 0').run();\n\n  const upsert = db.prepare(\n    `INSERT INTO languages (code, name, is_default, enabled)\n     VALUES (@code, @name, @is_default, @enabled)\n     ON CONFLICT(code) DO UPDATE SET\n       name = COALESCE(excluded.name, languages.name),\n       is_default = excluded.is_default,\n       enabled = CASE\n         WHEN languages.enabled = 1 THEN 1\n         ELSE excluded.enabled\n       END`\n  );\n\n  for (const code of configuredLanguages) {\n    const normalizedCode = code.trim();\n    if (!normalizedCode) {\n      continue;\n    }\n\n    const isDefault = normalizedCode === config.languages.default;\n    const existing = existingLanguages.find((l) => l.code === normalizedCode);\n\n    // Preserve user's enabled choice, or default to enabled for configured languages\n    const isEnabled = existing ? Boolean(existing.enabled) : true;\n\n    upsert.run({\n      code: normalizedCode,\n      name: resolveLanguageName(normalizedCode),\n      is_default: isDefault ? 1 : 0,\n      enabled: isEnabled ? 1 : 0\n    });\n  }\n}\n\nfunction resolveLanguageName(code: string): string {\n  try {\n    const displayNames = new Intl.DisplayNames([code], { type: 'language' });\n    const resolved = displayNames.of(code);\n    if (resolved) {\n      return resolved;\n    }\n  } catch (error) {\n    // Intl.DisplayNames may be unavailable; ignore and fallback\n  }\n\n  return code.toUpperCase();\n}\n\n","import Database from 'better-sqlite3';\nimport fs from 'node:fs';\nimport path from 'node:path';\n\nimport { runMigrations } from './migrations';\nimport { getBlogConfig } from '../config';\n\nexport type SqliteDatabase = Database.Database;\n\nconst DEFAULT_DB_FILENAME = 'blog.db';\nconst DB_PATH_ENV_VARS = ['NEXT_BLOG_DB_PATH', 'BLOG_DB_PATH'];\n\nlet dbInstance: SqliteDatabase | null = null;\n\nfunction resolveDatabasePath(): string {\n  for (const envVar of DB_PATH_ENV_VARS) {\n    const candidate = process.env[envVar];\n    if (candidate) {\n      return path.resolve(candidate);\n    }\n  }\n\n  const configPath = getBlogConfig().database.path;\n  if (configPath) {\n    return path.resolve(process.cwd(), configPath);\n  }\n\n  return path.resolve(process.cwd(), DEFAULT_DB_FILENAME);\n}\n\nfunction ensureDirectory(filePath: string) {\n  const directory = path.dirname(filePath);\n  if (!fs.existsSync(directory)) {\n    fs.mkdirSync(directory, { recursive: true });\n  }\n}\n\nfunction createDatabaseInstance(): SqliteDatabase {\n  const dbPath = resolveDatabasePath();\n  ensureDirectory(dbPath);\n\n  const db = new Database(dbPath);\n  db.pragma('foreign_keys = ON');\n  db.pragma('journal_mode = WAL');\n  db.pragma('synchronous = NORMAL');\n\n  runMigrations(db);\n\n  return db;\n}\n\nexport function getDatabase(): SqliteDatabase {\n  if (!dbInstance) {\n    dbInstance = createDatabaseInstance();\n  }\n\n  return dbInstance;\n}\n\nexport function closeDatabase() {\n  if (dbInstance) {\n    dbInstance.close();\n    dbInstance = null;\n  }\n}\n\n","import type { SqliteDatabase } from '../index';\nimport { getDatabase } from '../index';\n\nexport interface CategoryRecord {\n  id: number;\n  slug: string;\n  created_at: string;\n}\n\nexport interface CategoryTranslationRecord {\n  id: number;\n  category_id: number;\n  language: string;\n  name: string;\n  description: string | null;\n}\n\nexport interface CategoryTranslationInput {\n  language: string;\n  name: string;\n  description?: string | null;\n}\n\nexport interface CategoryWithTranslations extends CategoryRecord {\n  translations: CategoryTranslationRecord[];\n}\n\ninterface CreateCategoryInput {\n  slug: string;\n  translations: CategoryTranslationInput[];\n}\n\ninterface UpdateCategoryInput {\n  slug?: string;\n  translations?: CategoryTranslationInput[];\n}\n\nfunction db(): SqliteDatabase {\n  return getDatabase();\n}\n\nfunction fetchCategoryTranslations(categoryId: number): CategoryTranslationRecord[] {\n  return db()\n    .prepare(\n      `SELECT id, category_id, language, name, description\n       FROM category_translations\n       WHERE category_id = ?\n       ORDER BY language ASC`\n    )\n    .all(categoryId) as CategoryTranslationRecord[];\n}\n\nfunction mapCategory(record: CategoryRecord): CategoryWithTranslations {\n  return {\n    ...record,\n    translations: fetchCategoryTranslations(record.id)\n  };\n}\n\nexport function getCategoryById(id: number): CategoryWithTranslations | null {\n  const row = db()\n    .prepare('SELECT id, slug, created_at FROM categories WHERE id = ?')\n    .get(id) as CategoryRecord | undefined;\n\n  if (!row) {\n    return null;\n  }\n\n  return mapCategory(row);\n}\n\nexport function getCategoryBySlug(slug: string): CategoryWithTranslations | null {\n  const row = db()\n    .prepare('SELECT id, slug, created_at FROM categories WHERE slug = ?')\n    .get(slug) as CategoryRecord | undefined;\n\n  if (!row) {\n    return null;\n  }\n\n  return mapCategory(row);\n}\n\nexport function listCategories(): CategoryWithTranslations[] {\n  const rows = db()\n    .prepare('SELECT id, slug, created_at FROM categories ORDER BY created_at DESC')\n    .all() as CategoryRecord[];\n\n  return rows.map(mapCategory);\n}\n\nexport function createCategory(input: CreateCategoryInput): CategoryWithTranslations {\n  const insert = db().transaction((payload: CreateCategoryInput) => {\n    const result = db()\n      .prepare('INSERT INTO categories (slug) VALUES (?)')\n      .run(payload.slug);\n\n    const categoryId = Number(result.lastInsertRowid);\n\n    const insertTranslation = db().prepare(\n      `INSERT INTO category_translations (category_id, language, name, description)\n       VALUES (@categoryId, @language, @name, @description)`\n    );\n\n    for (const translation of payload.translations) {\n      insertTranslation.run({\n        categoryId,\n        language: translation.language,\n        name: translation.name,\n        description: translation.description ?? null\n      });\n    }\n\n    const category = getCategoryById(categoryId);\n    if (!category) {\n      throw new Error('Failed to create category');\n    }\n\n    return category;\n  });\n\n  return insert(input);\n}\n\nexport function updateCategory(id: number, input: UpdateCategoryInput): CategoryWithTranslations | null {\n  const update = db().transaction((payload: UpdateCategoryInput) => {\n    if (typeof payload.slug !== 'undefined') {\n      db()\n        .prepare('UPDATE categories SET slug = ? WHERE id = ?')\n        .run(payload.slug, id);\n    }\n\n    if (payload.translations) {\n      db().prepare('DELETE FROM category_translations WHERE category_id = ?').run(id);\n\n      const insertTranslation = db().prepare(\n        `INSERT INTO category_translations (category_id, language, name, description)\n         VALUES (@categoryId, @language, @name, @description)`\n      );\n\n      for (const translation of payload.translations) {\n        insertTranslation.run({\n          categoryId: id,\n          language: translation.language,\n          name: translation.name,\n          description: translation.description ?? null\n        });\n      }\n    }\n\n    return getCategoryById(id);\n  });\n\n  return update(input);\n}\n\nexport function deleteCategory(id: number) {\n  db().prepare('DELETE FROM categories WHERE id = ?').run(id);\n}\n\nexport function listCategoriesByLanguage(language: string): Array<{\n  category: CategoryRecord;\n  translation: CategoryTranslationRecord | null;\n}> {\n  const rows = db()\n    .prepare(\n      `SELECT\n        c.id as c_id,\n        c.slug as c_slug,\n        c.created_at as c_created_at,\n        ct.id as ct_id,\n        ct.language as ct_language,\n        ct.name as ct_name,\n        ct.description as ct_description\n       FROM categories c\n       LEFT JOIN category_translations ct\n         ON ct.category_id = c.id AND ct.language = ?\n       ORDER BY c.created_at DESC`\n    )\n    .all(language) as Array<{\n    c_id: number;\n    c_slug: string;\n    c_created_at: string;\n    ct_id: number | null;\n    ct_language: string | null;\n    ct_name: string | null;\n    ct_description: string | null;\n  }>;\n\n  return rows.map((row) => ({\n    category: {\n      id: row.c_id,\n      slug: row.c_slug,\n      created_at: row.c_created_at\n    },\n    translation:\n      row.ct_id != null\n        ? {\n            id: row.ct_id,\n            category_id: row.c_id,\n            language: row.ct_language ?? language,\n            name: row.ct_name ?? '',\n            description: row.ct_description\n          }\n        : null\n  }));\n}\n\n","import type { BlogStatus, Post, PostTranslation } from '../../types';\nimport type { SqliteDatabase } from '../index';\nimport { getDatabase } from '../index';\n\nexport interface PostRecord {\n  id: number;\n  slug: string;\n  author_id: number;\n  category_id: number | null;\n  featured_image: string | null;\n  status: BlogStatus;\n  published_at: string | null;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface PostTranslationRecord {\n  id: number;\n  post_id: number;\n  language: string;\n  title: string;\n  content: string;\n  excerpt: string | null;\n  meta_title: string | null;\n  meta_description: string | null;\n}\n\nexport interface PostTranslationInput {\n  language: string;\n  title: string;\n  content: string;\n  excerpt?: string | null;\n  metaTitle?: string | null;\n  metaDescription?: string | null;\n}\n\nexport interface CreatePostInput {\n  slug: string;\n  authorId: number;\n  categoryId?: number | null;\n  featuredImage?: string | null;\n  status?: BlogStatus;\n  publishedAt?: string | null;\n  translations: PostTranslationInput[];\n}\n\nexport interface UpdatePostInput {\n  slug?: string;\n  categoryId?: number | null;\n  featuredImage?: string | null;\n  status?: BlogStatus;\n  publishedAt?: string | null;\n  translations?: PostTranslationInput[];\n}\n\nexport interface ListPostsOptions {\n  status?: BlogStatus;\n  categoryId?: number;\n  authorId?: number;\n  search?: string;\n  language?: string;\n  limit?: number;\n  offset?: number;\n  orderBy?: 'created_at' | 'published_at' | 'updated_at';\n  orderDirection?: 'asc' | 'desc';\n}\n\nexport interface PaginatedPosts {\n  posts: PostWithTranslations[];\n  total: number;\n}\n\nexport interface PostWithTranslations extends PostRecord {\n  translations: PostTranslationRecord[];\n}\n\nfunction db(): SqliteDatabase {\n  return getDatabase();\n}\n\nfunction fetchPostTranslations(postId: number): PostTranslationRecord[] {\n  return db()\n    .prepare(\n      `SELECT id, post_id, language, title, content, excerpt, meta_title, meta_description\n       FROM post_translations\n       WHERE post_id = ?\n       ORDER BY language ASC`\n    )\n    .all(postId) as PostTranslationRecord[];\n}\n\nfunction mapPost(record: PostRecord): PostWithTranslations {\n  return {\n    ...record,\n    translations: fetchPostTranslations(record.id)\n  };\n}\n\nexport function getPostById(id: number): PostWithTranslations | null {\n  const row = db()\n    .prepare(\n      `SELECT id, slug, author_id, category_id, featured_image, status,\n              published_at, created_at, updated_at\n       FROM posts\n       WHERE id = ?`\n    )\n    .get(id) as PostRecord | undefined;\n\n  if (!row) {\n    return null;\n  }\n\n  return mapPost(row);\n}\n\nexport function getPostBySlug(slug: string): PostWithTranslations | null {\n  const row = db()\n    .prepare(\n      `SELECT id, slug, author_id, category_id, featured_image, status,\n              published_at, created_at, updated_at\n       FROM posts\n       WHERE slug = ?`\n    )\n    .get(slug) as PostRecord | undefined;\n\n  if (!row) {\n    return null;\n  }\n\n  return mapPost(row);\n}\n\nexport function listPosts(): PostWithTranslations[] {\n  const rows = db()\n    .prepare(\n      `SELECT id, slug, author_id, category_id, featured_image, status,\n              published_at, created_at, updated_at\n       FROM posts\n       ORDER BY created_at DESC`\n    )\n    .all() as PostRecord[];\n\n  return rows.map(mapPost);\n}\n\nexport function listPostsPaginated(options: ListPostsOptions = {}): PaginatedPosts {\n  const clauses: string[] = [];\n  const params: Record<string, unknown> = {};\n\n  if (options.status) {\n    clauses.push('p.status = @status');\n    params.status = options.status;\n  }\n\n  if (options.categoryId) {\n    clauses.push('p.category_id = @categoryId');\n    params.categoryId = options.categoryId;\n  }\n\n  if (options.authorId) {\n    clauses.push('p.author_id = @authorId');\n    params.authorId = options.authorId;\n  }\n\n  if (options.search && options.language) {\n    clauses.push(\n      `(pt.title LIKE @search OR pt.content LIKE @search OR pt.excerpt LIKE @search)`\n    );\n    params.search = `%${options.search}%`;\n  }\n\n  if (options.language) {\n    params.language = options.language;\n  }\n\n  const whereClause =\n    clauses.length > 0\n      ? `WHERE ${clauses.join(' AND ')}`\n      : '';\n\n  const baseQuery = `\n    FROM posts p\n    ${options.language ? 'LEFT JOIN post_translations pt ON pt.post_id = p.id AND pt.language = @language' : ''}\n    ${whereClause}\n  `;\n\n  const totalRow = db()\n    .prepare(`SELECT COUNT(DISTINCT p.id) as count ${baseQuery}`)\n    .get(params) as { count: number } | undefined;\n\n  const orderBy = options.orderBy ?? 'created_at';\n  const direction = (options.orderDirection ?? 'desc').toUpperCase();\n\n  const limit = options.limit ?? 20;\n  const offset = options.offset ?? 0;\n\n  const rows = db()\n    .prepare(\n      `\n      SELECT DISTINCT\n        p.id,\n        p.slug,\n        p.author_id,\n        p.category_id,\n        p.featured_image,\n        p.status,\n        p.published_at,\n        p.created_at,\n        p.updated_at\n      ${baseQuery}\n      ORDER BY p.${orderBy} ${direction}\n      LIMIT @limit\n      OFFSET @offset\n    `\n    )\n    .all({\n      ...params,\n      limit,\n      offset\n    }) as PostRecord[];\n\n  return {\n    posts: rows.map(mapPost),\n    total: totalRow?.count ?? 0\n  };\n}\n\nexport function createPost(input: CreatePostInput): PostWithTranslations {\n  const insert = db().transaction((payload: CreatePostInput) => {\n    const result = db()\n      .prepare(\n        `INSERT INTO posts (\n            slug,\n            author_id,\n            category_id,\n            featured_image,\n            status,\n            published_at\n          )\n          VALUES (@slug, @authorId, @categoryId, @featuredImage, @status, @publishedAt)`\n      )\n      .run({\n        slug: payload.slug,\n        authorId: payload.authorId,\n        categoryId: typeof payload.categoryId === 'undefined' ? null : payload.categoryId,\n        featuredImage: payload.featuredImage ?? null,\n        status: payload.status ?? 'draft',\n        publishedAt: payload.publishedAt ?? null\n      });\n\n    const postId = Number(result.lastInsertRowid);\n\n    const insertTranslation = db().prepare(\n      `INSERT INTO post_translations (\n          post_id,\n          language,\n          title,\n          content,\n          excerpt,\n          meta_title,\n          meta_description\n        )\n        VALUES (\n          @postId,\n          @language,\n          @title,\n          @content,\n          @excerpt,\n          @metaTitle,\n          @metaDescription\n        )`\n    );\n\n    for (const translation of payload.translations) {\n      insertTranslation.run({\n        postId,\n        language: translation.language,\n        title: translation.title,\n        content: translation.content,\n        excerpt: translation.excerpt ?? null,\n        metaTitle: translation.metaTitle ?? null,\n        metaDescription: translation.metaDescription ?? null\n      });\n    }\n\n    const post = getPostById(postId);\n    if (!post) {\n      throw new Error('Failed to create post');\n    }\n\n    return post;\n  });\n\n  return insert(input);\n}\n\nexport function updatePost(id: number, input: UpdatePostInput): PostWithTranslations | null {\n  const update = db().transaction((payload: UpdatePostInput) => {\n    const fields: string[] = [];\n    const params: Record<string, unknown> = { id };\n\n    if (typeof payload.slug !== 'undefined') {\n      fields.push('slug = @slug');\n      params.slug = payload.slug;\n    }\n\n    if (typeof payload.categoryId !== 'undefined') {\n      fields.push('category_id = @categoryId');\n      params.categoryId = payload.categoryId === null ? null : payload.categoryId;\n    }\n\n    if (typeof payload.featuredImage !== 'undefined') {\n      fields.push('featured_image = @featuredImage');\n      params.featuredImage = payload.featuredImage ?? null;\n    }\n\n    if (typeof payload.status !== 'undefined') {\n      fields.push('status = @status');\n      params.status = payload.status;\n    }\n\n    if (typeof payload.publishedAt !== 'undefined') {\n      fields.push('published_at = @publishedAt');\n      params.publishedAt = payload.publishedAt ?? null;\n    }\n\n    if (fields.length > 0) {\n      db()\n        .prepare(`UPDATE posts SET ${fields.join(', ')} WHERE id = @id`)\n        .run(params);\n    }\n\n    if (payload.translations) {\n      db().prepare('DELETE FROM post_translations WHERE post_id = ?').run(id);\n\n      const insertTranslation = db().prepare(\n        `INSERT INTO post_translations (\n            post_id,\n            language,\n            title,\n            content,\n            excerpt,\n            meta_title,\n            meta_description\n          )\n          VALUES (\n            @postId,\n            @language,\n            @title,\n            @content,\n            @excerpt,\n            @metaTitle,\n            @metaDescription\n          )`\n      );\n\n      for (const translation of payload.translations) {\n        insertTranslation.run({\n          postId: id,\n          language: translation.language,\n          title: translation.title,\n          content: translation.content,\n          excerpt: translation.excerpt ?? null,\n          metaTitle: translation.metaTitle ?? null,\n          metaDescription: translation.metaDescription ?? null\n        });\n      }\n    }\n\n    return getPostById(id);\n  });\n\n  return update(input);\n}\n\nexport function deletePost(id: number) {\n  db().prepare('DELETE FROM posts WHERE id = ?').run(id);\n}\n\nexport function mapPostToDomain(post: PostWithTranslations): Post {\n  return {\n    id: post.id,\n    slug: post.slug,\n    authorId: post.author_id,\n    categoryId: post.category_id ?? undefined,\n    featuredImage: post.featured_image ?? undefined,\n    status: post.status,\n    publishedAt: post.published_at ?? undefined,\n    createdAt: post.created_at,\n    updatedAt: post.updated_at,\n    translations: post.translations.map<PostTranslation>((translation) => ({\n      language: translation.language,\n      title: translation.title,\n      content: translation.content,\n      excerpt: translation.excerpt ?? undefined,\n      metaTitle: translation.meta_title ?? undefined,\n      metaDescription: translation.meta_description ?? undefined\n    }))\n  };\n}\n\n","import type { Language } from '../../types';\nimport type { SqliteDatabase } from '../index';\nimport { getDatabase } from '../index';\n\nexport interface LanguageRecord {\n  code: string;\n  name: string;\n  is_default: number;\n  enabled: number;\n}\n\nexport interface UpsertLanguageInput {\n  code: string;\n  name: string;\n  enabled?: boolean;\n  isDefault?: boolean;\n}\n\nfunction db(): SqliteDatabase {\n  return getDatabase();\n}\n\nfunction toLanguage(record: LanguageRecord): Language {\n  return {\n    code: record.code,\n    name: record.name,\n    isDefault: Boolean(record.is_default),\n    enabled: Boolean(record.enabled)\n  };\n}\n\nexport function listLanguages(): Language[] {\n  const rows = db()\n    .prepare(\n      `SELECT code, name, is_default, enabled\n       FROM languages\n       ORDER BY is_default DESC, name ASC`\n    )\n    .all() as LanguageRecord[];\n\n  return rows.map(toLanguage);\n}\n\nexport function getLanguage(code: string): Language | null {\n  const row = db()\n    .prepare(\n      `SELECT code, name, is_default, enabled\n       FROM languages\n       WHERE code = ?`\n    )\n    .get(code) as LanguageRecord | undefined;\n\n  return row ? toLanguage(row) : null;\n}\n\nexport function getDefaultLanguage(): Language | null {\n  const row = db()\n    .prepare(\n      `SELECT code, name, is_default, enabled\n       FROM languages\n       ORDER BY is_default DESC\n       LIMIT 1`\n    )\n    .get() as LanguageRecord | undefined;\n\n  return row ? toLanguage(row) : null;\n}\n\nexport function upsertLanguage(input: UpsertLanguageInput): Language {\n  const operation = db().transaction((payload: UpsertLanguageInput) => {\n    const existing = getLanguage(payload.code);\n\n    const enabled =\n      typeof payload.enabled === 'undefined'\n        ? existing?.enabled ?? true\n        : payload.enabled;\n\n    const isDefault =\n      typeof payload.isDefault === 'undefined'\n        ? existing?.isDefault ?? false\n        : payload.isDefault;\n\n    if (isDefault) {\n      db().prepare('UPDATE languages SET is_default = 0').run();\n    }\n\n    db()\n      .prepare(\n        `INSERT INTO languages (code, name, enabled, is_default)\n         VALUES (@code, @name, @enabled, @isDefault)\n         ON CONFLICT(code) DO UPDATE SET\n           name = excluded.name,\n           enabled = excluded.enabled,\n           is_default = excluded.is_default`\n      )\n      .run({\n        code: payload.code,\n        name: payload.name,\n        enabled: enabled ? 1 : 0,\n        isDefault: isDefault ? 1 : 0\n      });\n\n    return getLanguage(payload.code);\n  });\n\n  const language = operation(input);\n  if (!language) {\n    throw new Error('Failed to update language');\n  }\n\n  return language;\n}\n\nexport function deleteLanguage(code: string) {\n  db().prepare('DELETE FROM languages WHERE code = ?').run(code);\n}\n\nexport function setDefaultLanguage(code: string) {\n  const transaction = db().transaction((languageCode: string) => {\n    db().prepare('UPDATE languages SET is_default = 0').run();\n    db()\n      .prepare('UPDATE languages SET is_default = 1, enabled = 1 WHERE code = ?')\n      .run(languageCode);\n  });\n\n  transaction(code);\n}\n\n","export interface CookieOptions {\n  httpOnly?: boolean;\n  secure?: boolean;\n  path?: string;\n  maxAge?: number;\n  sameSite?: 'lax' | 'strict' | 'none';\n}\n\nexport interface SerializedCookie {\n  name: string;\n  value: string;\n  options?: CookieOptions;\n}\n\nexport function parseCookies(cookieHeader: string | undefined): Record<string, string> {\n  if (!cookieHeader) {\n    return {};\n  }\n\n  return cookieHeader.split(';').reduce<Record<string, string>>((acc, part) => {\n    const [name, ...rest] = part.trim().split('=');\n    if (!name) {\n      return acc;\n    }\n\n    const value = rest.join('=');\n    acc[name] = decodeURIComponent(value);\n    return acc;\n  }, {});\n}\n\nexport function serializeCookie(name: string, value: string, options: CookieOptions = {}): string {\n  const segments = [`${name}=${encodeURIComponent(value)}`];\n\n  if (options.maxAge !== undefined) {\n    segments.push(`Max-Age=${Math.floor(options.maxAge)}`);\n  }\n\n  if (options.path) {\n    segments.push(`Path=${options.path}`);\n  }\n\n  if (options.httpOnly) {\n    segments.push('HttpOnly');\n  }\n\n  if (options.secure) {\n    segments.push('Secure');\n  }\n\n  if (options.sameSite) {\n    segments.push(`SameSite=${capitalize(options.sameSite)}`);\n  }\n\n  return segments.join('; ');\n}\n\nfunction capitalize(value: string): string {\n  return value.charAt(0).toUpperCase() + value.slice(1).toLowerCase();\n}\n\n","import bcrypt from 'bcrypt';\nimport jwt, { type JwtPayload } from 'jsonwebtoken';\n\nimport { getBlogConfig } from '../config';\n\nexport interface CreateTokenOptions {\n  userId: number;\n  role: string;\n  sessionDurationDays?: number;\n}\n\nexport interface TokenPayload {\n  sub: number;\n  role: string;\n  exp: number;\n}\n\nexport interface VerifyTokenResult {\n  valid: boolean;\n  payload?: TokenPayload;\n  error?: Error;\n}\n\nconst DEFAULT_SESSION_DURATION_DAYS = 7;\nconst DEFAULT_SECRET_FALLBACK = 'change-me';\nlet warnedAboutSecret = false;\n\nfunction getJwtSecret(): string {\n  const envSecret = process.env.BLOG_JWT_SECRET ?? process.env.JWT_SECRET;\n  if (envSecret && envSecret !== DEFAULT_SECRET_FALLBACK) {\n    return envSecret;\n  }\n\n  const configSecret = getBlogConfig().auth.jwtSecret;\n  const secret = configSecret || DEFAULT_SECRET_FALLBACK;\n\n  if ((secret === DEFAULT_SECRET_FALLBACK || !secret) && process.env.NODE_ENV === 'production') {\n    throw new Error('JWT secret is not configured (set BLOG_JWT_SECRET)');\n  }\n\n  if ((secret === DEFAULT_SECRET_FALLBACK || !secret) && !warnedAboutSecret) {\n    warnedAboutSecret = true;\n    console.warn(\n      '[next-blog-cms] Using default JWT secret. Define BLOG_JWT_SECRET to secure your installation.'\n    );\n  }\n\n  return secret ?? DEFAULT_SECRET_FALLBACK;\n}\n\nexport async function hashPassword(password: string): Promise<string> {\n  return bcrypt.hash(password, 10);\n}\n\nexport async function verifyPassword(password: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(password, hash);\n}\n\nexport function createToken(options: CreateTokenOptions): string {\n  const secret = getJwtSecret();\n  const sessionDurationDays = options.sessionDurationDays ?? DEFAULT_SESSION_DURATION_DAYS;\n\n  return jwt.sign(\n    {\n      sub: options.userId,\n      role: options.role\n    },\n    secret,\n    {\n      expiresIn: `${sessionDurationDays}d`\n    }\n  );\n}\n\nexport function verifyToken(token: string): VerifyTokenResult {\n  try {\n    const secret = getJwtSecret();\n    const decoded = jwt.verify(token, secret);\n\n    if (typeof decoded === 'string') {\n      throw new Error('Invalid token');\n    }\n\n    const payload = normalizePayload(decoded);\n    if (!payload) {\n      throw new Error('Invalid token');\n    }\n\n    return {\n      valid: true,\n      payload\n    };\n  } catch (error) {\n    return {\n      valid: false,\n      error: error instanceof Error ? error : new Error('Invalid token')\n    };\n  }\n}\n\nexport function decodeToken(token: string): TokenPayload | null {\n  try {\n    const decoded = jwt.decode(token);\n    if (!decoded || typeof decoded === 'string') {\n      return null;\n    }\n\n    return normalizePayload(decoded as JwtPayload);\n  } catch {\n    return null;\n  }\n}\n\nfunction normalizePayload(value: JwtPayload): TokenPayload | null {\n  if (typeof value !== 'object' || value === null) {\n    return null;\n  }\n\n  const sub = typeof value.sub === 'string' ? Number(value.sub) : value.sub;\n  if (typeof sub !== 'number' || Number.isNaN(sub)) {\n    return null;\n  }\n\n  const role = (value as Record<string, unknown>).role;\n  if (typeof role !== 'string') {\n    return null;\n  }\n\n  const exp = value.exp;\n  if (typeof exp !== 'number') {\n    return null;\n  }\n\n  return {\n    sub,\n    role,\n    exp\n  };\n}\n\n","import { z } from 'zod';\n\nexport const languageCodeSchema = z\n  .string()\n  .min(2)\n  .max(5)\n  .regex(/^[a-z]{2,5}$/i, 'Invalid language code');\n\nexport const blogStatusSchema = z.enum(['draft', 'published']);\n\nexport const paginationSchema = z.object({\n  page: z.coerce.number().int().min(1).optional(),\n  limit: z.coerce.number().int().min(1).max(100).optional()\n});\n\nexport const postTranslationSchema = z.object({\n  language: languageCodeSchema,\n  title: z.string().min(1),\n  content: z.string().min(1),\n  excerpt: z.string().optional(),\n  metaTitle: z.string().optional(),\n  metaDescription: z.string().optional()\n});\n\nexport const categoryTranslationSchema = z.object({\n  language: languageCodeSchema,\n  name: z.string().min(1),\n  description: z.string().optional()\n});\n\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string().min(6),\n  remember: z.boolean().optional()\n});\n\nexport const createUserSchema = z.object({\n  name: z.string().min(1),\n  email: z.string().email(),\n  password: z.string().min(6),\n  role: z.enum(['admin', 'author']).optional()\n});\n\nexport const updateUserSchema = z.object({\n  name: z.string().min(1).optional(),\n  email: z.string().email().optional(),\n  password: z.string().min(6).optional(),\n  role: z.enum(['admin', 'author']).optional()\n});\n\nexport const createCategorySchema = z.object({\n  slug: z.string().min(1),\n  translations: z.array(categoryTranslationSchema).min(1)\n});\n\nexport const updateCategorySchema = z.object({\n  slug: z.string().min(1).optional(),\n  translations: z.array(categoryTranslationSchema).min(1).optional()\n});\n\nexport const withOptionalDateTime = (schema: z.ZodString) =>\n  schema.refine((value) => {\n    if (!value) return true;\n    const timestamp = Date.parse(value);\n    return !Number.isNaN(timestamp);\n  }, 'Invalid datetime');\n\nconst optionalDatetime = z\n  .string()\n  .refine((value) => {\n    if (value === undefined || value === null || value === '') return true;\n    const timestamp = Date.parse(value);\n    return !Number.isNaN(timestamp);\n  }, 'Invalid datetime')\n  .optional();\n\nexport const createPostSchema = z.object({\n  slug: z.string().min(1),\n  categoryId: z.number().int().positive().nullable().optional(),\n  featuredImage: z.string().url().nullable().optional(),\n  status: blogStatusSchema.optional(),\n  publishedAt: optionalDatetime,\n  translations: z.array(postTranslationSchema).min(1)\n});\n\nexport const updatePostSchema = z.object({\n  slug: z.string().min(1).optional(),\n  categoryId: z.number().int().positive().nullable().optional(),\n  featuredImage: z.string().url().nullable().optional(),\n  status: blogStatusSchema.optional(),\n  publishedAt: optionalDatetime,\n  translations: z.array(postTranslationSchema).min(1).optional()\n});\n\nexport const upsertLanguageSchema = z.object({\n  code: languageCodeSchema,\n  name: z.string().min(1),\n  enabled: z.boolean().optional(),\n  isDefault: z.boolean().optional()\n});\n\nexport const updateLanguageSchema = z.object({\n  name: z.string().min(1).optional(),\n  enabled: z.boolean().optional(),\n  isDefault: z.boolean().optional()\n});\n\n","export interface PaginationInput {\n  page?: number;\n  limit?: number;\n}\n\nexport interface PaginationMeta {\n  page: number;\n  limit: number;\n  offset: number;\n}\n\nexport function resolvePagination(input: PaginationInput = {}): PaginationMeta {\n  const limit = clampNumber(input.limit ?? 20, 1, 100);\n  const page = clampNumber(input.page ?? 1, 1, Number.MAX_SAFE_INTEGER);\n\n  return {\n    page,\n    limit,\n    offset: (page - 1) * limit\n  };\n}\n\nexport function clampNumber(value: number, min: number, max: number): number {\n  return Math.min(Math.max(value, min), max);\n}\n\nexport function ensureArray<T>(value: T | T[] | undefined | null): T[] {\n  if (Array.isArray(value)) {\n    return value;\n  }\n\n  if (typeof value === 'undefined' || value === null) {\n    return [];\n  }\n\n  return [value];\n}\n\nexport function pick<T extends object, K extends keyof T>(obj: T, keys: readonly K[]): Pick<T, K> {\n  const result = {} as Pick<T, K>;\n\n  for (const key of keys) {\n    if (key in obj) {\n      result[key] = obj[key];\n    }\n  }\n\n  return result;\n}\n\nexport function isObject(value: unknown): value is Record<string, unknown> {\n  return typeof value === 'object' && value !== null && !Array.isArray(value);\n}\n\n","import { userQueries } from '../../db/queries';\nimport { makeSetCookieHeader } from '../router';\nimport type { HandlerResult, RequestContext } from '../types';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport { loginSchema } from '../../lib/validation';\nimport { createToken, verifyPassword, verifyToken } from '../../lib/auth';\nimport { isObject } from '../../lib/utils';\nimport { getBlogConfig } from '../../config';\n\nexport async function handleAuthRoute(\n  req: RequestContext['request'],\n  _ctx: RequestContext\n): Promise<HandlerResult> {\n  const segments = req.segments.slice(1); // remove 'admin'\n  const action = segments[1];\n\n  if (action === 'login' && req.method === 'POST') {\n    return await handleLogin(req);\n  }\n\n  if (action === 'logout' && req.method === 'POST') {\n    return handleLogout(req);\n  }\n\n  if (action === 'status' && req.method === 'GET') {\n    return handleStatus(req);\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nasync function handleLogin(req: RequestContext['request']): Promise<HandlerResult> {\n  if (!isObject(req.body)) {\n    throw new HttpError('Invalid payload', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const parsed = loginSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const { email, password, remember } = parsed.data;\n\n  const user = userQueries.getUserByEmail(email);\n  if (!user) {\n    throw new HttpError('Invalid credentials', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const validPassword = await verifyPassword(password, user.password_hash);\n  if (!validPassword) {\n    throw new HttpError('Invalid credentials', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const sessionDuration = remember ? 15 : 7;\n  const token = createToken({\n    userId: user.id,\n    role: user.role,\n    sessionDurationDays: sessionDuration\n  });\n\n  const cookie = makeSetCookieHeader(token, req, sessionDuration);\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      user: serializeUser(user)\n    },\n    cookies: [cookie]\n  };\n}\n\nfunction handleLogout(req: RequestContext['request']): HandlerResult {\n  const cookie = makeSetCookieHeader('', req, 0);\n\n  return {\n    status: HttpStatus.NO_CONTENT,\n    cookies: [cookie]\n  };\n}\n\nfunction handleStatus(req: RequestContext['request']): HandlerResult {\n  const adminCount = userQueries.countAdmins();\n  const token = req.cookies['next_blog_token'];\n\n  let user: ReturnType<typeof serializeUser> | null = null;\n\n  if (token) {\n    const verification = verifyToken(token);\n    if (verification.valid && verification.payload) {\n      const record = userQueries.getUserById(verification.payload.sub);\n      if (record) {\n        user = serializeUser(record);\n      }\n    }\n  }\n\n  const config = getBlogConfig();\n  const theme = config.theme;\n  const aiTranslationEnabled = Boolean(config.ai?.translator);\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      hasUsers: adminCount > 0,\n      user,\n      theme: {\n        primaryColor: theme.primaryColor\n      },\n      features: {\n        aiTranslation: aiTranslationEnabled\n      }\n    }\n  };\n}\n\nfunction serializeUser(user: userQueries.BlogUserRecord) {\n  return {\n    id: user.id,\n    name: user.name,\n    email: user.email,\n    role: user.role,\n    createdAt: user.created_at\n  };\n}\n\n","import type { NormalizedRequest } from '../types';\n\nexport function getQueryParam(req: NormalizedRequest, name: string): string | undefined {\n  const value = req.query[name];\n  if (Array.isArray(value)) {\n    return value[0] ?? undefined;\n  }\n\n  if (typeof value === 'string') {\n    return value;\n  }\n\n  return undefined;\n}\n\nexport function getQueryParamBoolean(req: NormalizedRequest, name: string): boolean | undefined {\n  const value = getQueryParam(req, name);\n  if (typeof value === 'undefined') {\n    return undefined;\n  }\n\n  if (value === 'true') {\n    return true;\n  }\n\n  if (value === 'false') {\n    return false;\n  }\n\n  return undefined;\n}\n\n","import { categoryQueries, languageQueries, postQueries } from '../../db/queries';\nimport type { PostWithTranslations } from '../../db/queries/posts';\nimport type { Post } from '../../types';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport {\n  createPostSchema,\n  paginationSchema,\n  updatePostSchema\n} from '../../lib/validation';\nimport { resolvePagination } from '../../lib/utils';\nimport { getQueryParam } from '../utils/query';\nimport type { HandlerResult, RequestContext } from '../types';\n\nexport async function handlePostsRoute(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  const isAdmin = req.segments[0] === 'admin';\n  const segments = isAdmin ? req.segments.slice(1) : req.segments;\n\n  if (segments.length === 1) {\n    if (req.method === 'GET') {\n      return handleListPosts(req, ctx, isAdmin);\n    }\n\n    if (isAdmin && req.method === 'POST') {\n      return handleCreatePost(req, ctx);\n    }\n  }\n\n  if (segments.length === 2) {\n    const identifier = segments[1];\n\n    if (req.method === 'GET') {\n      return handleGetPost(req, ctx, identifier, isAdmin);\n    }\n\n    if (isAdmin && req.method === 'PUT') {\n      return handleUpdatePost(req, ctx, identifier);\n    }\n\n    if (isAdmin && req.method === 'DELETE') {\n      return handleDeletePost(ctx, identifier);\n    }\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nasync function handleListPosts(\n  req: RequestContext['request'],\n  ctx: RequestContext,\n  isAdmin: boolean\n): Promise<HandlerResult> {\n  const pagination = paginationSchema.safeParse({\n    page: getQueryParam(req, 'page'),\n    limit: getQueryParam(req, 'limit')\n  });\n  if (!pagination.success) {\n    throw new HttpError('Invalid pagination parameters', {\n      status: HttpStatus.BAD_REQUEST,\n      details: pagination.error.flatten()\n    });\n  }\n\n  const { limit, page, offset } = resolvePagination({\n    limit: pagination.data.limit,\n    page: pagination.data.page\n  });\n\n  const lang = getQueryParam(req, 'lang');\n  const statusQuery = getQueryParam(req, 'status');\n  const categorySlug = getQueryParam(req, 'category');\n  const search = getQueryParam(req, 'search');\n\n  let status: 'draft' | 'published' | undefined = isAdmin ? undefined : 'published';\n  if (isAdmin && statusQuery && (statusQuery === 'draft' || statusQuery === 'published')) {\n    status = statusQuery;\n  }\n\n  let categoryId: number | undefined;\n  if (categorySlug) {\n    const category = categoryQueries.getCategoryBySlug(categorySlug);\n    if (!category) {\n      return {\n        status: HttpStatus.OK,\n        data: {\n          posts: [],\n          total: 0,\n          page,\n          pages: 0\n        }\n      };\n    }\n    categoryId = category.id;\n  }\n\n  const authorId = isAdmin && ctx.user?.role === 'author' ? ctx.user.id : undefined;\n\n  const { posts, total } = postQueries.listPostsPaginated({\n    status,\n    categoryId,\n    authorId,\n    search: search ?? undefined,\n    language: lang ?? undefined,\n    limit,\n    offset,\n    orderBy: 'created_at'\n  });\n\n  if (isAdmin) {\n    const data = posts.map((post) => formatAdminPost(postQueries.mapPostToDomain(post)));\n    return {\n      status: HttpStatus.OK,\n      data: {\n        posts: data,\n        total,\n        page,\n        pages: Math.ceil(total / limit)\n      }\n    };\n  }\n\n  const defaultLanguage = languageQueries.getDefaultLanguage();\n  const defaultCode = defaultLanguage?.code ?? 'en';\n  const data = posts\n    .map((post) => formatPublicPost(post, lang ?? defaultCode, defaultCode))\n    .filter((post): post is NonNullable<typeof post> => Boolean(post));\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      posts: data,\n      total,\n      page,\n      pages: Math.ceil(total / limit)\n    }\n  };\n}\n\nasync function handleCreatePost(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  if (!ctx.user) {\n    throw new HttpError('Unauthorized', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const parsed = createPostSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const payload = parsed.data;\n  const publishedAt =\n    payload.status === 'published' && !payload.publishedAt\n      ? new Date().toISOString()\n      : payload.publishedAt ?? null;\n\n  const created = postQueries.createPost({\n    slug: payload.slug,\n    authorId: ctx.user.id,\n    categoryId: payload.categoryId ?? null,\n    featuredImage: payload.featuredImage ?? null,\n    status: payload.status ?? 'draft',\n    publishedAt,\n    translations: payload.translations.map((translation) => ({\n      language: translation.language,\n      title: translation.title,\n      content: translation.content,\n      excerpt: translation.excerpt,\n      metaTitle: translation.metaTitle,\n      metaDescription: translation.metaDescription\n    }))\n  });\n\n  return {\n    status: HttpStatus.CREATED,\n    data: {\n      post: formatAdminPost(postQueries.mapPostToDomain(created))\n    }\n  };\n}\n\nasync function handleGetPost(\n  req: RequestContext['request'],\n  _ctx: RequestContext,\n  identifier: string,\n  isAdmin: boolean\n): Promise<HandlerResult> {\n  if (isAdmin) {\n    const id = Number(identifier);\n    if (Number.isNaN(id)) {\n      throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n    }\n\n    const post = postQueries.getPostById(id);\n    if (!post) {\n      throw new HttpError('Post not found', { status: HttpStatus.NOT_FOUND });\n    }\n\n    return {\n      status: HttpStatus.OK,\n      data: {\n        post: formatAdminPost(postQueries.mapPostToDomain(post))\n      }\n    };\n  }\n\n  const lang = getQueryParam(req, 'lang');\n  const defaultLanguage = languageQueries.getDefaultLanguage();\n  const defaultCode = defaultLanguage?.code ?? 'en';\n\n  const post = postQueries.getPostBySlug(identifier);\n  if (!post || post.status !== 'published') {\n    throw new HttpError('Post not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const formatted = formatPublicPost(post, lang ?? defaultCode, defaultCode);\n  if (!formatted) {\n    throw new HttpError('Translation not available', { status: HttpStatus.NOT_FOUND });\n  }\n\n  return {\n    status: HttpStatus.OK,\n    data: { post: formatted }\n  };\n}\n\nasync function handleUpdatePost(\n  req: RequestContext['request'],\n  ctx: RequestContext,\n  identifier: string\n): Promise<HandlerResult> {\n  if (!ctx.user) {\n    throw new HttpError('Unauthorized', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const post = postQueries.getPostById(id);\n  if (!post) {\n    throw new HttpError('Post not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  if (ctx.user.role === 'author' && post.author_id !== ctx.user.id) {\n    throw new HttpError('You do not have permission to update this post', {\n      status: HttpStatus.FORBIDDEN\n    });\n  }\n\n  const parsed = updatePostSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const payload = parsed.data;\n  const nextStatus = payload.status ?? post.status;\n  let publishedAt = payload.publishedAt ?? post.published_at;\n\n  if (nextStatus === 'published' && !publishedAt) {\n    publishedAt = new Date().toISOString();\n  }\n\n  const updated = postQueries.updatePost(id, {\n    slug: payload.slug,\n    categoryId: typeof payload.categoryId === 'undefined' ? undefined : payload.categoryId,\n    featuredImage: payload.featuredImage,\n    status: payload.status,\n    publishedAt,\n    translations: payload.translations?.map((translation) => ({\n      language: translation.language,\n      title: translation.title,\n      content: translation.content,\n      excerpt: translation.excerpt,\n      metaTitle: translation.metaTitle,\n      metaDescription: translation.metaDescription\n    }))\n  });\n\n  if (!updated) {\n    throw new HttpError('Failed to update post', { status: HttpStatus.INTERNAL_SERVER_ERROR });\n  }\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      post: formatAdminPost(postQueries.mapPostToDomain(updated))\n    }\n  };\n}\n\nasync function handleDeletePost(ctx: RequestContext, identifier: string): Promise<HandlerResult> {\n  if (!ctx.user) {\n    throw new HttpError('Unauthorized', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const existing = postQueries.getPostById(id);\n  if (!existing) {\n    throw new HttpError('Post not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  if (ctx.user.role === 'author' && existing.author_id !== ctx.user.id) {\n    throw new HttpError('You do not have permission to delete this post', {\n      status: HttpStatus.FORBIDDEN\n    });\n  }\n\n  postQueries.deletePost(id);\n\n  return {\n    status: HttpStatus.NO_CONTENT\n  };\n}\n\nfunction formatAdminPost(post: Post) {\n  return {\n    id: post.id,\n    slug: post.slug,\n    authorId: post.authorId,\n    categoryId: post.categoryId ?? null,\n    featuredImage: post.featuredImage ?? null,\n    status: post.status,\n    publishedAt: post.publishedAt ?? null,\n    createdAt: post.createdAt,\n    updatedAt: post.updatedAt,\n    translations: post.translations.map((translation) => ({\n      language: translation.language,\n      title: translation.title,\n      content: translation.content,\n      excerpt: translation.excerpt ?? null,\n      metaTitle: translation.metaTitle ?? null,\n      metaDescription: translation.metaDescription ?? null\n    }))\n  };\n}\n\nfunction formatPublicPost(\n  post: PostWithTranslations,\n  language: string,\n  fallbackLanguage: string\n) {\n  const translation =\n    post.translations.find((t) => t.language === language) ??\n    post.translations.find((t) => t.language === fallbackLanguage) ??\n    post.translations[0];\n\n  if (!translation) {\n    return null;\n  }\n\n  const category =\n    post.category_id != null ? categoryQueries.getCategoryById(post.category_id) : null;\n  const categoryTranslation =\n    category?.translations.find((t) => t.language === language) ??\n    category?.translations.find((t) => t.language === fallbackLanguage) ??\n    category?.translations[0];\n\n  const readingTimeMinutes = calculateReadingTime(translation.content);\n\n  return {\n    id: post.id,\n    slug: post.slug,\n    title: translation.title,\n    content: translation.content,\n    excerpt: translation.excerpt,\n    metaTitle: translation.meta_title,\n    metaDescription: translation.meta_description,\n    featuredImage: post.featured_image,\n    status: post.status,\n    publishedAt: post.published_at,\n    createdAt: post.created_at,\n    updatedAt: post.updated_at,\n    readingTimeMinutes,\n    category: categoryTranslation\n      ? {\n          id: category!.id,\n          slug: category!.slug,\n          name: categoryTranslation.name,\n          description: categoryTranslation.description\n        }\n      : null\n  };\n}\n\nfunction calculateReadingTime(content: string): number {\n  const wordsPerMinute = 200;\n  const plainText = content.replace(/<[^>]+>/g, ' ');\n  const wordCount = plainText.split(/\\s+/).filter(Boolean).length;\n  return Math.ceil(wordCount / wordsPerMinute);\n}\n\n","import { categoryQueries, languageQueries, postQueries } from '../../db/queries';\nimport type { CategoryWithTranslations } from '../../db/queries/categories';\nimport type { HandlerResult, RequestContext } from '../types';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport { createCategorySchema, updateCategorySchema } from '../../lib/validation';\nimport { getQueryParam } from '../utils/query';\n\nexport async function handleCategoriesRoute(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  const isAdmin = req.segments[0] === 'admin';\n  const segments = isAdmin ? req.segments.slice(1) : req.segments;\n\n  if (segments.length === 1) {\n    if (req.method === 'GET') {\n      return handleListCategories(req, isAdmin);\n    }\n\n    if (isAdmin && req.method === 'POST') {\n      ensureAdmin(ctx);\n      return handleCreateCategory(req);\n    }\n  }\n\n  if (segments.length === 2) {\n    const identifier = segments[1];\n\n    if (req.method === 'GET') {\n      return handleGetCategory(req, identifier, isAdmin);\n    }\n\n    if (isAdmin && req.method === 'PUT') {\n      ensureAdmin(ctx);\n      return handleUpdateCategory(req, identifier);\n    }\n\n    if (isAdmin && req.method === 'DELETE') {\n      ensureAdmin(ctx);\n      return handleDeleteCategory(identifier);\n    }\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nfunction handleListCategories(req: RequestContext['request'], isAdmin: boolean): HandlerResult {\n  const lang = getQueryParam(req, 'lang');\n  const defaultLanguage = languageQueries.getDefaultLanguage();\n  const fallback = defaultLanguage?.code ?? 'en';\n\n  const categories = categoryQueries.listCategories();\n\n  if (isAdmin) {\n    return {\n      status: HttpStatus.OK,\n      data: {\n        categories: categories.map((category) => formatAdminCategory(category))\n      }\n    };\n  }\n\n  const formatted = categories\n    .map((category) => formatPublicCategory(category, lang ?? fallback, fallback))\n    .filter((category): category is NonNullable<typeof category> => Boolean(category));\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      categories: formatted\n    }\n  };\n}\n\nfunction handleGetCategory(\n  req: RequestContext['request'],\n  identifier: string,\n  isAdmin: boolean\n): HandlerResult {\n  if (isAdmin) {\n    const id = Number(identifier);\n    if (Number.isNaN(id)) {\n      throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n    }\n\n    const category = categoryQueries.getCategoryById(id);\n    if (!category) {\n      throw new HttpError('Category not found', { status: HttpStatus.NOT_FOUND });\n    }\n\n    return {\n      status: HttpStatus.OK,\n      data: {\n        category: formatAdminCategory(category)\n      }\n    };\n  }\n\n  const lang = getQueryParam(req, 'lang');\n  const defaultLanguage = languageQueries.getDefaultLanguage();\n  const fallback = defaultLanguage?.code ?? 'en';\n\n  const category = categoryQueries.getCategoryBySlug(identifier);\n  if (!category) {\n    throw new HttpError('Category not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const formatted = formatPublicCategory(category, lang ?? fallback, fallback);\n  if (!formatted) {\n    throw new HttpError('Category not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const { posts } = postQueries.listPostsPaginated({\n    status: 'published',\n    categoryId: category.id,\n    language: lang ?? fallback,\n    limit: 100,\n    offset: 0\n  });\n\n  const postsFormatted = posts\n    .map((post) => {\n      const translation =\n        post.translations.find((t) => t.language === (lang ?? fallback)) ??\n        post.translations.find((t) => t.language === fallback) ??\n        post.translations[0];\n\n      if (!translation) {\n        return null;\n      }\n\n      return {\n        id: post.id,\n        slug: post.slug,\n        title: translation.title,\n        excerpt: translation.excerpt,\n        publishedAt: post.published_at,\n        featuredImage: post.featured_image\n      };\n    })\n    .filter((post): post is NonNullable<typeof post> => Boolean(post));\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      category: formatted,\n      posts: postsFormatted\n    }\n  };\n}\n\nfunction handleCreateCategory(req: RequestContext['request']): HandlerResult {\n  const parsed = createCategorySchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const created = categoryQueries.createCategory(parsed.data);\n\n  return {\n    status: HttpStatus.CREATED,\n    data: {\n      category: formatAdminCategory(created)\n    }\n  };\n}\n\nfunction handleUpdateCategory(req: RequestContext['request'], identifier: string): HandlerResult {\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const existing = categoryQueries.getCategoryById(id);\n  if (!existing) {\n    throw new HttpError('Category not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const parsed = updateCategorySchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const updated = categoryQueries.updateCategory(id, parsed.data);\n  if (!updated) {\n    throw new HttpError('Failed to update category', {\n      status: HttpStatus.INTERNAL_SERVER_ERROR\n    });\n  }\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      category: formatAdminCategory(updated)\n    }\n  };\n}\n\nfunction handleDeleteCategory(identifier: string): HandlerResult {\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const existing = categoryQueries.getCategoryById(id);\n  if (!existing) {\n    throw new HttpError('Category not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  categoryQueries.deleteCategory(id);\n\n  return {\n    status: HttpStatus.NO_CONTENT\n  };\n}\n\nfunction ensureAdmin(ctx: RequestContext) {\n  if (!ctx.user || ctx.user.role !== 'admin') {\n    throw new HttpError('Permission denied', { status: HttpStatus.FORBIDDEN });\n  }\n}\n\nfunction formatAdminCategory(category: CategoryWithTranslations) {\n  return {\n    id: category.id,\n    slug: category.slug,\n    createdAt: category.created_at,\n    translations: category.translations.map((translation) => ({\n      id: translation.id,\n      language: translation.language,\n      name: translation.name,\n      description: translation.description\n    }))\n  };\n}\n\nfunction formatPublicCategory(\n  category: CategoryWithTranslations,\n  language: string,\n  fallbackLanguage: string\n) {\n  const translation =\n    category.translations.find((t) => t.language === language) ??\n    category.translations.find((t) => t.language === fallbackLanguage) ??\n    category.translations[0];\n\n  if (!translation) {\n    return null;\n  }\n\n  return {\n    id: category.id,\n    slug: category.slug,\n    name: translation.name,\n    description: translation.description\n  };\n}\n\n","import { userQueries } from '../../db/queries';\nimport type { HandlerResult, RequestContext } from '../types';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport { createUserSchema, updateUserSchema } from '../../lib/validation';\nimport { hashPassword } from '../../lib/auth';\n\nexport async function handleUsersRoute(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  const segments = req.segments.slice(1); // remove 'admin'\n\n  if (segments.length === 1) {\n    if (req.method === 'GET') {\n      ensureAdmin(ctx);\n      return handleListUsers();\n    }\n\n    if (req.method === 'POST') {\n      return await handleCreateUser(req, ctx);\n    }\n  }\n\n  if (segments.length === 2) {\n    const identifier = segments[1];\n\n    if (req.method === 'GET') {\n      ensureAdmin(ctx);\n      return handleGetUser(identifier);\n    }\n\n    if (req.method === 'PUT') {\n      ensureAdmin(ctx);\n      return await handleUpdateUser(identifier, req);\n    }\n\n    if (req.method === 'DELETE') {\n      ensureAdmin(ctx);\n      return handleDeleteUser(identifier, ctx);\n    }\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nfunction handleListUsers(): HandlerResult {\n  const users = userQueries.listUsers();\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      users: users.map(serializeUser)\n    }\n  };\n}\n\nasync function handleCreateUser(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  const parsed = createUserSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const hasAdmins = userQueries.countAdmins() > 0;\n\n  if (hasAdmins) {\n    ensureAdmin(ctx);\n  }\n\n  const payload = parsed.data;\n  const passwordHash = await hashPassword(payload.password);\n\n  const role = hasAdmins ? payload.role ?? 'author' : 'admin';\n\n  try {\n    const user = userQueries.createUser({\n      email: payload.email,\n      name: payload.name,\n      passwordHash,\n      role\n    });\n\n    return {\n      status: HttpStatus.CREATED,\n      data: {\n        user: serializeUser(user)\n      }\n    };\n  } catch (error) {\n    throw new HttpError('Unable to create user', {\n      status: HttpStatus.CONFLICT,\n      details: error\n    });\n  }\n}\n\nfunction handleGetUser(identifier: string): HandlerResult {\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const user = userQueries.getUserById(id);\n  if (!user) {\n    throw new HttpError('User not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      user: serializeUser(user)\n    }\n  };\n}\n\nasync function handleUpdateUser(\n  identifier: string,\n  req: RequestContext['request']\n): Promise<HandlerResult> {\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const existing = userQueries.getUserById(id);\n  if (!existing) {\n    throw new HttpError('User not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const parsed = updateUserSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const input = parsed.data;\n\n  if (existing.role === 'admin' && input.role === 'author') {\n    const adminCount = userQueries.countAdmins();\n    if (adminCount <= 1) {\n      throw new HttpError('At least one administrator must remain', {\n        status: HttpStatus.CONFLICT\n      });\n    }\n  }\n\n  const passwordHash = input.password\n    ? await hashPassword(input.password)\n    : undefined;\n\n  const updated = userQueries.updateUser(id, {\n    email: input.email,\n    name: input.name,\n    passwordHash,\n    role: input.role\n  });\n\n  if (!updated) {\n    throw new HttpError('Failed to update user', { status: HttpStatus.INTERNAL_SERVER_ERROR });\n  }\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      user: serializeUser(updated)\n    }\n  };\n}\n\nfunction handleDeleteUser(identifier: string, ctx: RequestContext): HandlerResult {\n  const id = Number(identifier);\n  if (Number.isNaN(id)) {\n    throw new HttpError('Invalid ID', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const existing = userQueries.getUserById(id);\n  if (!existing) {\n    throw new HttpError('User not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  if (ctx.user && existing.id === ctx.user.id) {\n    throw new HttpError('You cannot delete your own user', {\n      status: HttpStatus.CONFLICT\n    });\n  }\n\n  if (existing.role === 'admin') {\n    const adminCount = userQueries.countAdmins();\n    if (adminCount <= 1) {\n      throw new HttpError('At least one administrator must remain', {\n        status: HttpStatus.CONFLICT\n      });\n    }\n  }\n\n  userQueries.deleteUser(id);\n\n  return {\n    status: HttpStatus.NO_CONTENT\n  };\n}\n\nfunction ensureAdmin(ctx: RequestContext) {\n  if (!ctx.user || ctx.user.role !== 'admin') {\n    throw new HttpError('Permission denied', { status: HttpStatus.FORBIDDEN });\n  }\n}\n\nfunction serializeUser(user: userQueries.BlogUserRecord) {\n  return {\n    id: user.id,\n    name: user.name,\n    email: user.email,\n    role: user.role,\n    createdAt: user.created_at\n  };\n}\n\n","import { languageQueries } from '../../db/queries';\nimport type { HandlerResult, RequestContext } from '../types';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport { upsertLanguageSchema, updateLanguageSchema } from '../../lib/validation';\n\nexport async function handleLanguagesRoute(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  const isAdmin = req.segments[0] === 'admin';\n  const segments = isAdmin ? req.segments.slice(1) : req.segments;\n\n  if (segments.length === 1) {\n    if (req.method === 'GET') {\n      return handleListLanguages();\n    }\n\n    if (isAdmin && req.method === 'POST') {\n      ensureAdmin(ctx);\n      return handleCreateLanguage(req);\n    }\n  }\n\n  if (segments.length === 2 && isAdmin) {\n    const code = segments[1];\n\n    if (req.method === 'PUT') {\n      ensureAdmin(ctx);\n      return handleUpdateLanguage(code, req);\n    }\n\n    if (req.method === 'DELETE') {\n      ensureAdmin(ctx);\n      return handleDeleteLanguage(code);\n    }\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nfunction handleListLanguages(): HandlerResult {\n  const languages = languageQueries.listLanguages();\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      languages\n    }\n  };\n}\n\nfunction handleCreateLanguage(req: RequestContext['request']): HandlerResult {\n  const parsed = upsertLanguageSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const language = languageQueries.upsertLanguage(parsed.data);\n\n  return {\n    status: HttpStatus.CREATED,\n    data: {\n      language\n    }\n  };\n}\n\nfunction handleUpdateLanguage(code: string, req: RequestContext['request']): HandlerResult {\n  const parsed = updateLanguageSchema.safeParse(req.body);\n  if (!parsed.success) {\n    throw new HttpError('Invalid data', {\n      status: HttpStatus.BAD_REQUEST,\n      details: parsed.error.flatten()\n    });\n  }\n\n  const current = languageQueries.getLanguage(code);\n  if (!current) {\n    throw new HttpError('Language not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const nextEnabled = parsed.data.enabled ?? current.enabled;\n  const nextDefault = parsed.data.isDefault ?? current.isDefault;\n\n  if (current.isDefault && !nextDefault) {\n    throw new HttpError('Set another language as default before changing this one', {\n      status: HttpStatus.CONFLICT\n    });\n  }\n\n  if (nextDefault && !nextEnabled) {\n    throw new HttpError('The default language must be enabled', {\n      status: HttpStatus.CONFLICT\n    });\n  }\n\n  if (!nextEnabled) {\n    const enabledLanguages = languageQueries\n      .listLanguages()\n      .filter((language) => language.enabled && language.code !== code);\n\n    if (enabledLanguages.length === 0) {\n      throw new HttpError('At least one language must remain enabled', {\n        status: HttpStatus.CONFLICT\n      });\n    }\n  }\n\n  const language = languageQueries.upsertLanguage({\n    code,\n    name: parsed.data.name ?? current.name,\n    enabled: nextEnabled,\n    isDefault: nextDefault\n  });\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      language\n    }\n  };\n}\n\nfunction handleDeleteLanguage(code: string): HandlerResult {\n  const language = languageQueries.getLanguage(code);\n  if (!language) {\n    throw new HttpError('Language not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  if (language.isDefault) {\n    throw new HttpError('Cannot remove the default language', {\n      status: HttpStatus.CONFLICT\n    });\n  }\n\n  const enabledLanguages = languageQueries.listLanguages().filter((lang) => lang.enabled);\n  if (enabledLanguages.length <= 1) {\n    throw new HttpError('At least one language must remain enabled', {\n      status: HttpStatus.CONFLICT\n    });\n  }\n\n  languageQueries.deleteLanguage(code);\n\n  return {\n    status: HttpStatus.NO_CONTENT\n  };\n}\n\nfunction ensureAdmin(ctx: RequestContext) {\n  if (!ctx.user || ctx.user.role !== 'admin') {\n    throw new HttpError('Permission denied', { status: HttpStatus.FORBIDDEN });\n  }\n}\n\n","import { getBlogConfig, type BlogAiTranslatorOpenAIConfig } from '../../config';\nimport { HttpError, HttpStatus } from '../http';\nimport { isObject } from '../utils';\n\nexport interface TranslateContentInput {\n  sourceLanguage: string;\n  targetLanguages: string[];\n  fields: Record<string, string | null | undefined>;\n}\n\nexport type TranslateContentResult = Record<string, Record<string, string>>;\n\nconst DEFAULT_OPENAI_MODEL = 'gpt-4o-mini';\n\nexport async function translateContent(\n  input: TranslateContentInput\n): Promise<TranslateContentResult> {\n  if (!input.targetLanguages.length) {\n    throw new HttpError('No target languages provided', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const config = getBlogConfig();\n  const translator = config.ai?.translator;\n\n  if (!translator) {\n    throw new HttpError('AI translation is not configured', { status: HttpStatus.NOT_IMPLEMENTED });\n  }\n\n  switch (translator.provider) {\n    case 'openai':\n      return translateWithOpenAi(input, translator);\n    default:\n      throw new HttpError('Unsupported AI translation provider', { status: HttpStatus.BAD_REQUEST });\n  }\n}\n\nasync function translateWithOpenAi(\n  input: TranslateContentInput,\n  config: BlogAiTranslatorOpenAIConfig\n): Promise<TranslateContentResult> {\n  const apiKey = config.apiKey ?? process.env.OPENAI_API_KEY;\n\n  if (!apiKey) {\n    throw new HttpError('OpenAI API key is not configured', {\n      status: HttpStatus.INTERNAL_SERVER_ERROR\n    });\n  }\n\n  const endpoint = config.baseUrl?.replace(/\\/$/, '') ?? 'https://api.openai.com/v1/chat/completions';\n  const response = await fetch(endpoint, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${apiKey}`\n    },\n    body: JSON.stringify({\n      model: config.model ?? DEFAULT_OPENAI_MODEL,\n      temperature: 0.2,\n      response_format: { type: 'json_object' },\n      messages: [\n        {\n          role: 'system',\n          content:\n            'You are a helpful assistant that translates blog posts. Respond with a JSON object only.'\n        },\n        {\n          role: 'user',\n          content: JSON.stringify({\n            sourceLanguage: input.sourceLanguage,\n            targetLanguages: input.targetLanguages,\n            fields: input.fields\n          })\n        }\n      ]\n    })\n  });\n\n  if (!response.ok) {\n    let reason = response.statusText;\n    try {\n      const errorPayload = (await response.json()) as { error?: { message?: string } };\n      if (errorPayload?.error?.message) {\n        reason = errorPayload.error.message;\n      }\n    } catch {\n      // ignore parsing failures\n    }\n\n    throw new HttpError(`AI translation request failed: ${reason}`, {\n      status: response.status >= 500 ? HttpStatus.INTERNAL_SERVER_ERROR : HttpStatus.BAD_REQUEST\n    });\n  }\n\n  const payload = (await response.json()) as {\n    choices?: Array<{ message?: { content?: string } }>;\n  };\n\n  const content = payload.choices?.[0]?.message?.content;\n\n  if (!content) {\n    throw new HttpError('AI translation response did not include content', {\n      status: HttpStatus.INTERNAL_SERVER_ERROR\n    });\n  }\n\n  let parsed: unknown;\n  try {\n    parsed = JSON.parse(content);\n  } catch (error) {\n    throw new HttpError('Failed to parse AI translation response', {\n      status: HttpStatus.INTERNAL_SERVER_ERROR,\n      details: error instanceof Error ? error.message : undefined\n    });\n  }\n\n  if (!isObject(parsed) || !isObject(parsed.translations)) {\n    throw new HttpError('AI translation response has an unexpected format', {\n      status: HttpStatus.INTERNAL_SERVER_ERROR\n    });\n  }\n\n  const translations = Object.entries(parsed.translations as Record<string, unknown>).reduce<\n    TranslateContentResult\n  >((acc, [language, value]) => {\n    if (!isObject(value)) {\n      return acc;\n    }\n\n    const fields: Record<string, string> = {};\n    for (const [key, fieldValue] of Object.entries(value)) {\n      if (typeof fieldValue === 'string') {\n        fields[key] = fieldValue;\n      }\n    }\n\n    acc[language] = fields;\n    return acc;\n  }, {});\n\n  return translations;\n}\n\n","import { translateContent } from '../../lib/ai/translator';\nimport { HttpError, HttpStatus } from '../../lib/http';\nimport { isObject } from '../../lib/utils';\nimport type { HandlerResult, RequestContext } from '../types';\n\nexport async function handleAiRoute(\n  req: RequestContext['request'],\n  ctx: RequestContext\n): Promise<HandlerResult> {\n  if (!ctx.user) {\n    throw new HttpError('Unauthorized', { status: HttpStatus.UNAUTHORIZED });\n  }\n\n  const segments = req.segments.slice(1); // remove 'admin'\n  const action = segments[1];\n\n  if (segments[0] === 'ai' && action === 'translate' && req.method === 'POST') {\n    return handleTranslate(req);\n  }\n\n  throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n}\n\nasync function handleTranslate(req: RequestContext['request']): Promise<HandlerResult> {\n  const payload = parseTranslateBody(req.body);\n  const translations = await translateContent(payload);\n\n  return {\n    status: HttpStatus.OK,\n    data: {\n      translations\n    }\n  };\n}\n\nfunction parseTranslateBody(body: unknown) {\n  if (!isObject(body)) {\n    throw new HttpError('Invalid payload', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const sourceLanguage = typeof body.sourceLanguage === 'string' ? body.sourceLanguage.trim() : '';\n  if (!sourceLanguage) {\n    throw new HttpError('sourceLanguage is required', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const targetLanguages = Array.isArray(body.targetLanguages)\n    ? body.targetLanguages.filter((value): value is string => typeof value === 'string' && value.trim())\n    : [];\n\n  if (!targetLanguages.length) {\n    throw new HttpError('targetLanguages is required', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  const fields: Record<string, string> = {};\n\n  if (isObject(body.fields)) {\n    for (const [key, value] of Object.entries(body.fields)) {\n      if (typeof key === 'string' && key.trim() && typeof value === 'string') {\n        fields[key] = value;\n      }\n    }\n  }\n\n  if (Object.keys(fields).length === 0) {\n    throw new HttpError('fields must include at least one value', { status: HttpStatus.BAD_REQUEST });\n  }\n\n  return {\n    sourceLanguage,\n    targetLanguages,\n    fields\n  };\n}\n\n","import { userQueries } from '../db/queries';\nimport type {\n  AuthenticatedUser,\n  HandlerResult,\n  IncomingRequest,\n  NormalizedRequest,\n  RequestContext\n} from './types';\nimport { parseCookies, serializeCookie } from '../lib/cookies';\nimport { HttpError, HttpStatus } from '../lib/http';\nimport { verifyToken } from '../lib/auth';\nimport { handleAuthRoute } from './routes/auth';\nimport { handlePostsRoute } from './routes/posts';\nimport { handleCategoriesRoute } from './routes/categories';\nimport { handleUsersRoute } from './routes/users';\nimport { handleLanguagesRoute } from './routes/languages';\nimport { handleAiRoute } from './routes/ai';\n\nconst ADMIN_PREFIX = 'admin';\nconst AUTH_PREFIX = 'auth';\nconst COOKIE_NAME = 'next_blog_token';\n\ninterface ResolvedRoute {\n  handler: (req: NormalizedRequest, ctx: RequestContext) => Promise<HandlerResult>;\n  requiresAuth: boolean;\n}\n\nexport async function handleRequest(incoming: IncomingRequest): Promise<HandlerResult> {\n  const normalized = normalizeRequest(incoming);\n\n  const resolved = resolveRoute(normalized);\n\n  if (!resolved) {\n    throw new HttpError('Route not found', { status: HttpStatus.NOT_FOUND });\n  }\n\n  const ctx: RequestContext = { request: normalized };\n\n  if (resolved.requiresAuth) {\n    const user = authenticate(normalized);\n    if (!user) {\n      throw new HttpError('Unauthorized', { status: HttpStatus.UNAUTHORIZED });\n    }\n    ctx.user = user;\n  }\n\n  const result = await resolved.handler(normalized, ctx);\n\n  return result;\n}\n\nfunction normalizeRequest(incoming: IncomingRequest): NormalizedRequest {\n  const url = new URL(incoming.url, 'http://localhost');\n  const pathSegments = url.pathname.split('/').filter(Boolean);\n  const segments = stripBaseSegments(pathSegments);\n\n  const headers = Object.fromEntries(\n    Object.entries(incoming.headers).map(([key, value]) => [key.toLowerCase(), value])\n  );\n\n  const query: Record<string, string | string[]> = {};\n\n  for (const key of url.searchParams.keys()) {\n    const all = url.searchParams.getAll(key);\n    query[key] = all.length > 1 ? all : all[0] ?? '';\n  }\n\n  if (incoming.query) {\n    for (const [key, value] of Object.entries(incoming.query)) {\n      query[key] = value;\n    }\n  }\n\n  return {\n    method: incoming.method.toUpperCase(),\n    pathname: `/${segments.join('/')}`,\n    segments,\n    headers,\n    query,\n    body: incoming.body,\n    cookies: parseCookies(headers.cookie)\n  };\n}\n\nfunction stripBaseSegments(segments: string[]): string[] {\n  if (segments[0] === 'api' && segments[1] === 'blog') {\n    return segments.slice(2);\n  }\n\n  if (segments[0] === 'blog') {\n    return segments.slice(1);\n  }\n\n  return segments;\n}\n\nfunction resolveRoute(request: NormalizedRequest): ResolvedRoute | null {\n  const segments = request.segments;\n  if (segments.length === 0) {\n    if (globalThis.process?.env?.NODE_ENV !== 'production') {\n      console.warn('[next-blog-cms] Rota raiz da API chamada sem segments.');\n    }\n    return {\n      handler: async () => ({\n        status: HttpStatus.OK,\n        data: { ok: true }\n      }),\n      requiresAuth: false\n    };\n  }\n\n  if (segments[0] === ADMIN_PREFIX) {\n    const adminSegments = segments.slice(1);\n\n    if (adminSegments[0] === AUTH_PREFIX) {\n      return {\n        handler: handleAuthRoute,\n        requiresAuth: false\n      };\n    }\n\n    if (adminSegments[0] === 'posts') {\n      return {\n        handler: handlePostsRoute,\n        requiresAuth: true\n      };\n    }\n\n    if (adminSegments[0] === 'categories') {\n      return {\n        handler: handleCategoriesRoute,\n        requiresAuth: true\n      };\n    }\n\n    if (adminSegments[0] === 'users') {\n      const requiresAuth =\n        !(request.method === 'POST' && adminSegments.length === 1 && userQueries.countAdmins() === 0);\n\n      return {\n        handler: handleUsersRoute,\n        requiresAuth\n      };\n    }\n\n    if (adminSegments[0] === 'languages') {\n      return {\n        handler: handleLanguagesRoute,\n        requiresAuth: true\n      };\n    }\n\n    if (adminSegments[0] === 'ai') {\n      return {\n        handler: handleAiRoute,\n        requiresAuth: true\n      };\n    }\n\n    return null;\n  }\n\n  if (segments[0] === 'posts') {\n    return {\n      handler: handlePostsRoute,\n      requiresAuth: false\n    };\n  }\n\n  if (segments[0] === 'categories') {\n    return {\n      handler: handleCategoriesRoute,\n      requiresAuth: false\n    };\n  }\n\n  if (segments[0] === 'languages') {\n    return {\n      handler: handleLanguagesRoute,\n      requiresAuth: false\n    };\n  }\n\n      return null;\n}\n\nfunction authenticate(request: NormalizedRequest): AuthenticatedUser | null {\n  const token = request.cookies[COOKIE_NAME] ?? extractTokenFromHeader(request);\n\n  if (!token) {\n    return null;\n  }\n\n  const verification = verifyToken(token);\n  if (!verification.valid || !verification.payload) {\n    return null;\n  }\n\n  const user = userQueries.getUserById(verification.payload.sub);\n  if (!user) {\n    return null;\n  }\n\n  return {\n    id: user.id,\n    role: user.role\n  };\n}\n\nfunction extractTokenFromHeader(request: NormalizedRequest): string | undefined {\n  const authHeader = request.headers.authorization;\n  if (!authHeader) {\n    return undefined;\n  }\n\n  const [scheme, token] = authHeader.split(' ');\n  if (scheme?.toLowerCase() !== 'bearer' || !token) {\n    return undefined;\n  }\n\n  return token;\n}\n\nexport function makeSetCookieHeader(token: string, request: NormalizedRequest, maxAgeDays: number) {\n  const secure =\n    request.headers['x-forwarded-proto'] === 'https' ||\n    request.headers.host?.includes('localhost') === false;\n\n  return serializeCookie('next_blog_token', token, {\n    httpOnly: true,\n    secure,\n    path: '/',\n    maxAge: maxAgeDays * 24 * 60 * 60,\n    sameSite: 'lax'\n  });\n}\n\n","import { createResponse } from '../lib/http';\nimport type { HandlerResult } from './types';\n\nexport function handlerResultToResponse(result: HandlerResult): Response {\n  const payload = typeof result.data === 'undefined' ? undefined : result.data;\n  const response = createResponse(payload, {\n    status: result.status,\n    headers: result.headers\n  });\n\n  if (result.cookies?.length) {\n    for (const cookie of result.cookies) {\n      response.headers.append('Set-Cookie', cookie);\n    }\n  }\n\n  return response;\n}\n\n","import type { NextApiRequest, NextApiResponse } from 'next';\nimport { NextRequest } from 'next/server';\n\nimport { createErrorResponse, HttpError, HttpStatus } from '../lib/http';\nimport { handleRequest } from './router';\nimport { handlerResultToResponse } from './utils';\nimport type { HandlerResult } from './types';\n\nexport async function blogApiHandler(req: NextApiRequest, res: NextApiResponse) {\n  try {\n    const result = await handleRequest({\n      method: req.method ?? 'GET',\n      url: `${inferProtocol(req)}://${req.headers.host ?? 'localhost'}${req.url ?? ''}`,\n      headers: Object.fromEntries(\n        Object.entries(req.headers).map(([key, value]) => [key, String(value)])\n      ),\n      body: req.body,\n      query: req.query as Record<string, string | string[]>\n    });\n\n    applyHandlerResultToNodeResponse(result, res);\n  } catch (error) {\n    const response = createErrorResponse(error);\n    res.status(response.status);\n    response.headers.forEach((value, key) => {\n      res.setHeader(key, value);\n    });\n    const text = await response.text();\n    res.send(text);\n  }\n}\n\nexport async function blogApiHandlerApp(req: NextRequest) {\n  try {\n    const method = req.method?.toUpperCase() ?? 'GET';\n\n    let body: unknown;\n    if (['POST', 'PUT', 'PATCH'].includes(method)) {\n      const text = await req.text();\n      if (text.trim().length > 0) {\n        try {\n          body = JSON.parse(text);\n        } catch {\n          throw new HttpError('Invalid payload', { status: HttpStatus.BAD_REQUEST });\n        }\n      }\n    }\n\n    const result = await handleRequest({\n      method,\n      url: req.url,\n      headers: Object.fromEntries(req.headers.entries()),\n      body,\n      query: Object.fromEntries(new URL(req.url).searchParams.entries())\n    });\n\n    return handlerResultToResponse(result);\n  } catch (error) {\n    return createErrorResponse(error);\n  }\n}\n\nfunction inferProtocol(req: NextApiRequest): string {\n  const forwardedProto = req.headers['x-forwarded-proto'];\n  if (Array.isArray(forwardedProto)) {\n    return forwardedProto[0];\n  }\n  if (forwardedProto) {\n    return forwardedProto;\n  }\n  const socket = req.socket as { encrypted?: boolean };\n  return socket.encrypted ? 'https' : 'http';\n}\n\nfunction applyHandlerResultToNodeResponse(result: HandlerResult, res: NextApiResponse) {\n  res.status(result.status);\n\n  if (result.headers) {\n    for (const [key, value] of Object.entries(result.headers)) {\n      res.setHeader(key, value);\n    }\n  }\n\n  if (result.cookies?.length) {\n    res.setHeader('Set-Cookie', result.cookies);\n  }\n\n  if (typeof result.data === 'undefined') {\n    res.send('');\n  } else {\n    res.json(result.data);\n  }\n}\n\n"]}