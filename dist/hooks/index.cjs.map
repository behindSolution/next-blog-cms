{"version":3,"sources":["../../src/hooks/index.ts"],"names":["useState","useMemo","useRef","useEffect","useCallback"],"mappings":"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","file":"index.cjs","sourcesContent":["import { useCallback, useEffect, useMemo, useRef, useState } from 'react';\n\nimport type { BlogStatus, Language } from '../types';\n\nexport type LanguageCode = string;\n\nexport interface BlogPostCategory {\n  id: number;\n  slug: string;\n  name: string;\n  description?: string | null;\n}\n\nexport interface BlogPost {\n  id: number;\n  slug: string;\n  title: string;\n  content: string;\n  excerpt?: string | null;\n  metaTitle?: string | null;\n  metaDescription?: string | null;\n  featuredImage?: string | null;\n  status: BlogStatus;\n  publishedAt?: string | null;\n  createdAt: string;\n  updatedAt: string;\n  readingTimeMinutes: number;\n  category: BlogPostCategory | null;\n}\n\nexport interface UsePostsOptions {\n  lang?: LanguageCode;\n  limit?: number;\n  page?: number;\n  category?: string;\n  status?: 'draft' | 'published';\n}\n\nexport interface UsePostsResult<TPost = BlogPost> {\n  posts: TPost[];\n  total: number;\n  page: number;\n  pages: number;\n  loading: boolean;\n  error: unknown;\n  hasMore: boolean;\n  loadMore: () => void;\n  reset: () => void;\n}\n\nexport function usePosts<TPost = BlogPost>(options: UsePostsOptions = {}): UsePostsResult<TPost> {\n  const limit = options.limit ?? 10;\n  const isControlled = typeof options.page === 'number';\n  const [internalPage, setInternalPage] = useState<number>(options.page ?? 1);\n  const page = isControlled ? options.page! : internalPage;\n  const [items, setItems] = useState<TPost[]>([]);\n  const [meta, setMeta] = useState<{ total: number; pages: number }>({ total: 0, pages: 0 });\n\n  const filters = useMemo(\n    () => ({\n      lang: options.lang ?? null,\n      category: options.category ?? null,\n      status: options.status ?? null,\n      limit\n    }),\n    [options.lang, options.category, options.status, limit]\n  );\n\n  const filtersKey = useMemo(() => JSON.stringify(filters), [filters]);\n  const filtersKeyRef = useRef(filtersKey);\n\n  useEffect(() => {\n    if (filtersKeyRef.current !== filtersKey) {\n      filtersKeyRef.current = filtersKey;\n      setMeta({ total: 0, pages: 0 });\n      setItems([]);\n      if (!isControlled) {\n        setInternalPage(1);\n      }\n    }\n  }, [filtersKey, isControlled]);\n\n  useEffect(() => {\n    if (isControlled && typeof options.page === 'number') {\n      setInternalPage(options.page);\n    }\n  }, [isControlled, options.page]);\n\n  const url = buildUrl('/api/blog/posts', {\n    lang: filters.lang ?? undefined,\n    category: filters.category ?? undefined,\n    status: filters.status ?? undefined,\n    limit,\n    page\n  });\n\n  const { data, error, loading } = useApiFetch<PostsResponse<TPost>>(url);\n\n  useEffect(() => {\n    if (!data) return;\n    setMeta({ total: data.total, pages: data.pages });\n\n    if (isControlled) {\n      setItems(data.posts);\n      return;\n    }\n\n    setItems((previous) => {\n      if (page === 1) {\n        return data.posts;\n      }\n\n      const deduped = [...previous];\n      const existingKeys = new Set(\n        previous.map((item) => {\n          const candidate = item as unknown as { id?: number; slug?: string };\n          return candidate.id ?? candidate.slug ?? JSON.stringify(item);\n        })\n      );\n\n      data.posts.forEach((post) => {\n        const candidate = post as unknown as { id?: number; slug?: string };\n        const key = candidate.id ?? candidate.slug ?? JSON.stringify(post);\n        if (!existingKeys.has(key)) {\n          existingKeys.add(key);\n          deduped.push(post);\n        }\n      });\n\n      return deduped;\n    });\n  }, [data, isControlled, page]);\n\n  const hasMore = meta.pages > 0 ? page < meta.pages : false;\n\n  const loadMore = useCallback(() => {\n    if (isControlled) return;\n    if (hasMore && !loading) {\n      setInternalPage((current) => current + 1);\n    }\n  }, [hasMore, isControlled, loading]);\n\n  const reset = useCallback(() => {\n    if (!isControlled) {\n      setInternalPage(1);\n    }\n    setItems([]);\n    setMeta({ total: 0, pages: 0 });\n  }, [isControlled]);\n\n  return {\n    posts: items,\n    total: meta.total,\n    page,\n    pages: meta.pages,\n    loading,\n    error,\n    hasMore,\n    loadMore,\n    reset\n  };\n}\n\nexport interface UsePostOptions {\n  lang?: LanguageCode;\n}\n\nexport interface UsePostResult<TPost = BlogPost> {\n  post: TPost | null;\n  loading: boolean;\n  error: unknown;\n}\n\nexport function usePost<TPost = BlogPost>(slug: string, options: UsePostOptions = {}): UsePostResult<TPost> {\n  const sanitizedSlug = slug?.trim();\n  const url = sanitizedSlug\n    ? buildUrl(`/api/blog/posts/${encodeURIComponent(sanitizedSlug)}`, {\n        lang: options.lang\n      })\n    : null;\n\n  const { data, error, loading } = useApiFetch<PostResponse<TPost>>(url);\n\n  return {\n    post: data?.post ?? null,\n    loading: Boolean(url) ? loading : false,\n    error\n  };\n}\n\nexport interface UseCategoriesOptions {\n  lang?: LanguageCode;\n}\n\nexport interface UseCategoriesResult<TCategory = BlogPostCategory> {\n  categories: TCategory[];\n  loading: boolean;\n  error: unknown;\n}\n\nexport function useCategories<TCategory = BlogPostCategory>(\n  options: UseCategoriesOptions = {}\n): UseCategoriesResult<TCategory> {\n  const url = buildUrl('/api/blog/categories', { lang: options.lang });\n  const { data, error, loading } = useApiFetch<CategoriesResponse<TCategory>>(url);\n\n  return {\n    categories: data?.categories ?? [],\n    loading,\n    error\n  };\n}\n\nexport interface UseLanguagesResult<TLanguage = Language> {\n  languages: TLanguage[];\n  loading: boolean;\n  error: unknown;\n}\n\nexport function useLanguages<TLanguage = Language>(): UseLanguagesResult<TLanguage> {\n  const url = '/api/blog/languages';\n  const { data, error, loading } = useApiFetch<LanguagesResponse<TLanguage>>(url);\n\n  return {\n    languages: data?.languages ?? [],\n    loading,\n    error\n  };\n}\n\ninterface PostsResponse<TPost> {\n  posts: TPost[];\n  total: number;\n  page: number;\n  pages: number;\n}\n\ninterface PostResponse<TPost> {\n  post: TPost;\n}\n\ninterface CategoriesResponse<TCategory> {\n  categories: TCategory[];\n}\n\ninterface LanguagesResponse<TLanguage> {\n  languages: TLanguage[];\n}\n\ninterface ErrorWithStatus extends Error {\n  status?: number;\n  body?: unknown;\n}\n\nfunction buildUrl(base: string, params: Record<string, unknown>): string {\n  const searchParams = new URLSearchParams();\n\n  Object.entries(params).forEach(([key, value]) => {\n    if (value === undefined || value === null || value === '') {\n      return;\n    }\n    searchParams.set(key, String(value));\n  });\n\n  const query = searchParams.toString();\n  return query ? `${base}?${query}` : base;\n}\n\ninterface FetchState<TData> {\n  data: TData | undefined;\n  error: unknown;\n  loading: boolean;\n}\n\nfunction useApiFetch<TResponse>(url: string | null): FetchState<TResponse> {\n  const [state, setState] = useState<FetchState<TResponse>>({\n    data: undefined,\n    error: undefined,\n    loading: Boolean(url)\n  });\n  const requestIdRef = useRef(0);\n  const stableUrl = useMemo(() => url, [url]);\n\n  useEffect(() => {\n    if (!stableUrl) {\n      setState({ data: undefined, error: undefined, loading: false });\n      return;\n    }\n\n    const controller = new AbortController();\n    const requestId = ++requestIdRef.current;\n\n    setState((previous) => ({\n      data: previous.data,\n      error: undefined,\n      loading: true\n    }));\n\n    (async () => {\n      try {\n        const data = await fetchJson<TResponse>(stableUrl, controller.signal);\n        if (requestId === requestIdRef.current) {\n          setState({ data, error: undefined, loading: false });\n        }\n      } catch (error) {\n        if (requestId === requestIdRef.current) {\n          setState((previous) => ({\n            data: previous.data,\n            error,\n            loading: false\n          }));\n        }\n      }\n    })();\n\n    return () => {\n      controller.abort();\n    };\n  }, [stableUrl]);\n\n  return state;\n}\n\nasync function fetchJson<TResponse>(url: string, signal?: AbortSignal): Promise<TResponse> {\n  const response = await fetch(url, {\n    headers: {\n      Accept: 'application/json'\n    },\n    signal\n  });\n\n  if (!response.ok) {\n    let errorBody: unknown;\n    try {\n      errorBody = await response.json();\n    } catch {\n      errorBody = undefined;\n    }\n    const error = new Error('Request failed');\n    (error as ErrorWithStatus).status = response.status;\n    (error as ErrorWithStatus).body = errorBody;\n    throw error;\n  }\n\n  if (response.status === 204) {\n    return undefined as TResponse;\n  }\n\n  return (await response.json()) as TResponse;\n}\n\n"]}